var fn=Object.defineProperty;var pn=(e,t,n)=>t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ve=(e,t,n)=>pn(e,typeof t!="symbol"?t+"":t,n);import{j as c,r as i}from"./index-stOZwat0.js";import{D as mn,M as hn,n as gn,A as yn}from"./constants-DPfYaiHO.js";import{g as Pe,c as we,a as Ke,l as xn,b as dt,w as wn,d as bn,s as vn}from"./App-DkoxpDh2.js";import{b as Jt,g as Zt,e as Sn,D as Mn}from"./index-CL8xa2Tr.js";const Pt={debug:0,info:1,warn:2,error:3},An={minLevel:"warn",enabled:!0};let It={...An};function ke(e){const t=()=>`[${e}]`,n=r=>It.enabled?Pt[r]>=Pt[It.minLevel]:!1;return{debug:(r,s)=>{n("debug")&&(s?console.log(t(),r,s):console.log(t(),r))},info:(r,s)=>{n("info")&&(s?console.log(t(),r,s):console.log(t(),r))},warn:(r,s)=>{n("warn")&&(s?console.warn(t(),r,s):console.warn(t(),r))},error:(r,s,a)=>{n("error")&&(a?console.error(t(),r,s,a):s?console.error(t(),r,s):console.error(t(),r))}}}const re={assetLoader:ke("AssetLoader"),audioPlayer:ke("AudioPlayer"),gameState:ke("GameState"),millionaireGame:ke("MillionaireGame"),errorBoundary:ke("ErrorBoundary")};let Re=null,tt=!0,ye=!1;const Tt=new Map,Ie=new Map,Te=new Map,Et=new Map,nt=new Map;let Je="";const Ee=e=>{try{return new URL(e,window.location.href).href}catch{return e}},Pn=e=>/\.mp3$/i.test(e)?"audio/mpeg":/\.wav$/i.test(e)?"audio/wav":/\.m4a$/i.test(e)?"audio/mp4":"audio/ogg",In=(e,t)=>{const n=Et.get(e);if(n)return n;const r=new Blob([t],{type:Pn(e)}),s=URL.createObjectURL(r);return Et.set(e,s),s},Tn=e=>{Je=e},rt=e=>{ye=e},Ae=()=>ye,En=async(e,t)=>{const n=Ee(e);if(Te.set(n,t.slice(0)),Ie.has(n))return!0;const r=Le();if(!r)return!1;try{const s=await r.decodeAudioData(t.slice(0));return Ie.set(n,s),!0}catch{return!1}},Lt=(e,t)=>{const n=Ee(e);Te.set(n,t.slice(0))},_e=e=>{const t=Ee(e),n=Te.get(t);return n?In(t,n):null},Ge=()=>{const e=Le();if(!e)return;e.state==="suspended"&&e.resume().catch(()=>{});const t=e.createBuffer(1,1,e.sampleRate),n=e.createBufferSource();n.buffer=t,n.connect(e.destination),n.start(0)},yt={answerButton:{tones:[{frequency:800,duration:.08,type:"sine",volume:.2}]},actionButton:{tones:[{frequency:294,duration:.2,type:"sawtooth",volume:.2},{frequency:392,duration:.2,type:"sawtooth",volume:.25},{frequency:523,duration:.3,type:"sawtooth",volume:.3}],delayBetween:.15},lifelineFifty:{tones:[{frequency:1200,duration:.05,type:"square",volume:.15},{frequency:800,duration:.05,type:"square",volume:.15},{frequency:1e3,duration:.1,type:"sine",volume:.2}],delayBetween:.04},lifelinePhone:{tones:[{frequency:600,duration:.1,type:"sine",volume:.2},{frequency:800,duration:.1,type:"sine",volume:.2},{frequency:1e3,duration:.15,type:"sine",volume:.25}],delayBetween:.08},lifelineHost:{tones:[{frequency:750,duration:.09,type:"sine",volume:.18},{frequency:950,duration:.12,type:"sine",volume:.22},{frequency:1150,duration:.14,type:"sine",volume:.25}],delayBetween:.07},lifelineAudience:{tones:[{frequency:300,duration:.1,type:"triangle",volume:.2},{frequency:400,duration:.1,type:"triangle",volume:.2},{frequency:500,duration:.15,type:"triangle",volume:.25}],delayBetween:.06},lifelineSwitch:{tones:[{frequency:520,duration:.08,type:"triangle",volume:.22},{frequency:780,duration:.12,type:"triangle",volume:.26},{frequency:1040,duration:.18,type:"triangle",volume:.28}],delayBetween:.06},lifelineDouble:{tones:[{frequency:900,duration:.06,type:"square",volume:.18},{frequency:900,duration:.06,type:"square",volume:.18},{frequency:600,duration:.14,type:"sine",volume:.22}],delayBetween:.04},retreatButton:{tones:[{frequency:523,duration:.12,type:"triangle",volume:.25},{frequency:659,duration:.12,type:"triangle",volume:.25},{frequency:784,duration:.12,type:"triangle",volume:.25},{frequency:1047,duration:.3,type:"triangle",volume:.3}],delayBetween:.1},victory:{tones:[{frequency:523,duration:.2,type:"sawtooth",volume:.25},{frequency:659,duration:.2,type:"sawtooth",volume:.28},{frequency:784,duration:.2,type:"sawtooth",volume:.3},{frequency:1047,duration:.25,type:"sawtooth",volume:.32},{frequency:1047,duration:.5,type:"triangle",volume:.35}],delayBetween:.15},defeat:{tones:[{frequency:400,duration:.2,type:"sawtooth",volume:.3},{frequency:300,duration:.2,type:"sawtooth",volume:.3},{frequency:200,duration:.4,type:"sawtooth",volume:.35}],delayBetween:.15},correct:{tones:[{frequency:523,duration:.12,type:"triangle",volume:.25},{frequency:659,duration:.12,type:"triangle",volume:.25},{frequency:784,duration:.2,type:"triangle",volume:.3}],delayBetween:.1},modeSelect:{tones:[{frequency:600,duration:.08,type:"triangle",volume:.2},{frequency:900,duration:.12,type:"triangle",volume:.25}],delayBetween:.06}},Le=()=>{if(!ye||!tt)return null;if(!Re)try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return tt=!1,re.audioPlayer.warn("Web Audio API is not supported"),null;Re=new e}catch(e){return tt=!1,re.audioPlayer.warn("Failed to create AudioContext",{error:e}),null}return Re.state==="suspended"&&Re.resume().catch(()=>{}),Re},Ye=()=>{const e=Le();e&&e.state==="suspended"&&e.resume().catch(()=>{})},Qe=async(e,t)=>{const n=Ee(e);Te.set(n,t.slice(0));const r=Le();if(!r)return null;const s=Ie.get(n);if(s)return s;const a=nt.get(n);if(a)return a;const o=(async()=>{try{const l=await r.decodeAudioData(t.slice(0));return Ie.set(n,l),l}catch(l){return re.audioPlayer.warn(`Failed to decode audio: ${n}`,{error:l}),null}finally{nt.delete(n)}})();return nt.set(n,o),o},Ve=(e,t=1)=>{const n=Le();if(!n)return null;const r=n.createBufferSource(),s=n.createGain();return r.buffer=e,r.connect(s),s.connect(n.destination),s.gain.value=t,r.start(0),{stop:()=>{try{r.stop()}catch{}}}},st=(e,t=1)=>{Ve(e,t)},Ln=({frequency:e,duration:t,type:n="sine",volume:r=.3,attack:s=.01,decay:a=.1,startOffset:o=0})=>{if(!ye)return;const l=Le();if(!l)return;const u=l.createOscillator(),d=l.createGain();u.connect(d),d.connect(l.destination),u.frequency.value=e,u.type=n;const f=l.currentTime+o;d.gain.setValueAtTime(0,f),d.gain.linearRampToValueAtTime(r,f+s),d.gain.linearRampToValueAtTime(r*.7,f+s+t*.5),d.gain.linearRampToValueAtTime(0,f+t),u.start(f),u.stop(f+t+a)},xt=e=>{if(!ye)return;const{tones:t,delayBetween:n=.1}=e;t.forEach((r,s)=>{Ln({...r,startOffset:s*n})})},Cn=async(e,t,n)=>{let r=Tt.get(e);r||(r=new Audio,r.preload="auto",Tt.set(e,r)),r.src!==t&&(r.src=t);const s=r.cloneNode();s.volume=n;try{return await s.play(),!0}catch(a){return re.audioPlayer.warn(`Failed to play ${t}`,{error:a}),!1}},en=async(e,t)=>{const n=Ee(e);if(!n.includes("/sounds/"))return await we(n)?Cn(n,n,t):!1;const s=Ie.get(n);if(s)return st(s,t),!0;const a=Te.get(n);if(a){const l=await Qe(n,a);return l?(st(l,t),!0):!1}if(!await we(n))return!1;try{const l=await fetch(n);if(!l.ok)return!1;const u=await l.arrayBuffer(),d=await Qe(n,u);return d?(st(d,t),!0):!1}catch(l){re.audioPlayer.warn(`Failed to load audio: ${n}`,{error:l})}return!1},kn=e=>e.replace(/\.(m4a|mp3|ogg|wav)$/i,"").toLowerCase().trim(),tn=e=>{const t=kn(e);return t.startsWith("select-")?"modeSelect":t==="answer-click"?"answerButton":t==="action-press"?"actionButton":t==="lifeline-fifty"?"lifelineFifty":t==="lifeline-phone"?"lifelinePhone":t==="lifeline-audience"?"lifelineAudience":t==="lifeline-host"?"lifelineHost":t==="lifeline-switch"?"lifelineSwitch":t==="lifeline-double"?"lifelineDouble":t==="retreat"?"retreatButton":t==="victory"?"victory":t==="defeat"?"defeat":t==="correct"?"correct":null},Ct=async(e,t=1)=>{if(!ye)return"none";const n=Pe("sounds",e,Je);if(await en(n.specific,t))return"file";const r=tn(e);return r?(xt(yt[r]),"oscillator"):(re.audioPlayer.warn(`No sound available for: ${e}`),"none")},Rn=async(e,t)=>{const n=Ee(e),r=Ie.get(n);if(r)return Ve(r,t);const s=Te.get(n);if(s){const o=await Qe(n,s);return o?Ve(o,t):null}if(!await we(n))return null;try{const o=await fetch(n);if(!o.ok)return null;const l=await o.arrayBuffer(),u=await Qe(n,l);if(u)return Ve(u,t)}catch(o){re.audioPlayer.warn(`Failed to load audio: ${n}`,{error:o})}return null},kt=async(e,t=1)=>{if(!ye)return null;const n=Pe("sounds",e,Je),r=await Rn(n.specific,t)||null;if(r)return r;const s=tn(e);return s?(xt(yt[s]),{stop:()=>{}}):(re.audioPlayer.warn(`No sound available for: ${e}`),null)},Nn=e=>{if(!ye)return;const t=yt[e];t&&xt(t)},Fn=async(e,t=1)=>{if(!ye)return!1;const n=Pe("voices",e,Je);return!!await en(n.specific,t)},$e=(e,t=Math.random)=>{const n=[...e];for(let r=n.length-1;r>0;r--){const s=Math.floor(t()*(r+1));[n[r],n[s]]=[n[s],n[r]]}return n},jn=(e,t=Math.random)=>{const n=[];for(const r of mn){const s=e[r]||[],o=$e(s,t).slice(0,hn);n.push(...o)}return n},$n=(e,t)=>{if(t<=0)return 1;const n=e/t;return n<1/3?1:n<2/3?2:3},at=[1e-4,2e-4,3e-4,5e-4,.001,.002,.004,.008,.016,.032,.064,.125,.25,.5,1],Rt=e=>{if(e<=0)return 0;const t=[100,200,300,400,500,600,700,800,900,1e3,1500,2e3,2500,3e3,4e3,5e3,6e3,7e3,8e3,9e3,1e4,12e3,15e3,16e3,2e4,25e3,3e4,32e3,4e4,5e4,6e4,64e3,75e3,8e4,1e5,125e3,15e4,2e5,25e4,3e5,4e5,5e5,6e5,75e4,8e5,1e6,15e5,2e6,25e5,3e6,4e6,5e6,1e7,15e6,2e7,25e6,5e7,1e8];let n=t[0],r=Math.abs(e-n);for(const s of t){const a=Math.abs(e-s);a<r&&(r=a,n=s)}return n},Dn=e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "),Bn=e=>{if(e<=0)return[];if(e===15)return[...at];const t=[];for(let n=0;n<e;n++){const r=n/(e-1)*14,s=Math.floor(r),a=Math.min(s+1,14),o=r-s,l=at[s],u=at[a],d=l*Math.pow(u/l,o);t.push(d)}return t},zn=(e,t)=>{if(e<=0)return{values:[],guaranteed:[]};const{maxPrize:n,guaranteedFractions:r}=t,s=Bn(e),a=[];let o=0;for(let u=0;u<e;u++){const d=n*s[u];let f=Rt(d);f<=o&&(f=o+(o<1e3?100:o<1e4?500:o<1e5?1e3:1e4),f=Rt(f));const h=u===e-1?n:f;a.push(Dn(h)),o=h}const l=[];for(const u of r){const d=Math.round(u*e)-1;d>=0&&d<e&&!l.includes(d)&&l.push(d)}return l.sort((u,d)=>u-d),{values:a,guaranteed:l}},On=(e,t)=>{const n=t.guaranteed.filter(s=>s<e);if(n.length===0)return"0";const r=Math.max(...n);return t.values[r]},_n=({correctOriginalIndex:e,shuffledAnswers:t,rng:n})=>{const r=[0,1,2,3].filter(s=>t[s]!==e);return $e(r,n).slice(0,2)},Wn=({correctDisplayIndex:e,eliminatedDisplayIndices:t=[],rng:n=Math.random})=>{const r=[0,0,0,0],s=40+Math.floor(n()*35);r[e]=s;let a=100-s;return[0,1,2,3].filter(l=>l!==e&&!t.includes(l)).forEach((l,u,d)=>{if(u===d.length-1)r[l]=a;else{const f=Math.floor(n()*a*.6);r[l]=f,a-=f}}),r},qn=({correctOriginalIndex:e,rng:t=Math.random})=>{if(t()>.2)return{isConfident:!0,suggestedOriginalIndex:e};const r=[0,1,2,3].filter(a=>a!==e);return{isConfident:!1,suggestedOriginalIndex:r[Math.floor(t()*r.length)]}},Hn=({correctDisplayIndex:e,eliminatedDisplayIndices:t=[],rng:n=Math.random,confidentChance:r=.78})=>{const a=[0,1,2,3].filter(u=>!t.includes(u)).filter(u=>u!==e),o=n()<r;return{suggestedDisplayIndex:o||a.length===0?e:a[Math.floor(n()*a.length)],confidence:o?"confident":"uncertain"}},Gn=({currentQuestionIndex:e,totalQuestions:t,rng:n=Math.random})=>{const r=e+1;if(r>=t)return null;const s=t-r;return r+Math.floor(n()*s)},Nt=(e,t,n=Math.random)=>{const r=e.campaigns.find(l=>l.id===t);if(!r)return null;const s=jn(r.questions,n),a=zn(s.length,e.prizes),o=$e([0,1,2,3],n);return{questions:s,prizeLadder:a,shuffledAnswers:o}},nn=()=>({phase:"start",selectedCampaignId:null,questions:[],prizeLadder:{values:[],guaranteed:[]},currentQuestionIndex:0,selectedAnswerDisplayIndex:null,shuffledAnswers:[0,1,2,3],eliminatedAnswerDisplayIndices:[],lifelineAvailability:{fifty:!0,phone:!0,audience:!0,host:!1,switch:!1,double:!1},lifelineResult:null,doubleDipArmed:!1,doubleDipStrikeUsed:!1,wonPrize:"0"}),Yn={start:new Set(["SELECT_CAMPAIGN","START_GAME","NEW_GAME"]),play:new Set(["ANSWER_SELECTED","ANSWER_RESOLVED","RETREAT","CLEAR_LIFELINE_RESULT","APPLY_LIFELINE_FIFTY","APPLY_LIFELINE_PHONE","APPLY_LIFELINE_AUDIENCE","APPLY_LIFELINE_HOST","APPLY_LIFELINE_SWITCH","APPLY_LIFELINE_DOUBLE","FORCE_WIN","NEW_GAME"]),victory:new Set(["NEW_GAME"]),defeat:new Set(["NEW_GAME"]),retreat:new Set(["NEW_GAME"])},Vn=(e,t)=>Yn[e].has(t),Un=(e,t)=>{var n,r,s,a,o,l;if(!Vn(e.phase,t.type)&&t.type!=="NEW_GAME")return e;switch(t.type){case"SELECT_CAMPAIGN":return{...e,selectedCampaignId:t.campaignId,questions:((n=t.session)==null?void 0:n.questions)??[],prizeLadder:((r=t.session)==null?void 0:r.prizeLadder)??{values:[],guaranteed:[]},shuffledAnswers:((s=t.session)==null?void 0:s.shuffledAnswers)??[0,1,2,3]};case"START_GAME":return{...e,phase:"play",selectedCampaignId:t.campaignId,questions:((a=t.session)==null?void 0:a.questions)??[],prizeLadder:((o=t.session)==null?void 0:o.prizeLadder)??{values:[],guaranteed:[]},shuffledAnswers:((l=t.session)==null?void 0:l.shuffledAnswers)??[0,1,2,3],currentQuestionIndex:0,selectedAnswerDisplayIndex:null,eliminatedAnswerDisplayIndices:[],lifelineAvailability:t.lifelineAvailability,lifelineResult:null,doubleDipArmed:!1,doubleDipStrikeUsed:!1,wonPrize:"0"};case"NEW_GAME":return nn();case"FORCE_WIN":return{...e,phase:"victory",selectedAnswerDisplayIndex:null,eliminatedAnswerDisplayIndices:[],lifelineResult:null,wonPrize:t.prize};case"ANSWER_SELECTED":return e.phase!=="play"||e.selectedAnswerDisplayIndex!==null||e.eliminatedAnswerDisplayIndices.includes(t.displayIndex)?e:{...e,selectedAnswerDisplayIndex:t.displayIndex,lifelineResult:null};case"ANSWER_RESOLVED":{if(e.phase!=="play"||e.selectedAnswerDisplayIndex===null)return e;if(t.outcome==="retry"){if(!e.doubleDipArmed||e.doubleDipStrikeUsed)return e;const u=e.eliminatedAnswerDisplayIndices.includes(e.selectedAnswerDisplayIndex)?e.eliminatedAnswerDisplayIndices:[...e.eliminatedAnswerDisplayIndices,e.selectedAnswerDisplayIndex];return{...e,selectedAnswerDisplayIndex:null,eliminatedAnswerDisplayIndices:u,doubleDipStrikeUsed:!0,lifelineResult:{type:"double",stage:"strike"}}}return t.outcome==="correct"?{...e,currentQuestionIndex:t.nextQuestionIndex??e.currentQuestionIndex,selectedAnswerDisplayIndex:null,eliminatedAnswerDisplayIndices:[],shuffledAnswers:t.nextShuffledAnswers??e.shuffledAnswers,doubleDipArmed:!1,doubleDipStrikeUsed:!1}:{...e,phase:t.outcome==="victory"?"victory":"defeat",wonPrize:t.wonPrize,doubleDipArmed:!1,doubleDipStrikeUsed:!1}}case"RETREAT":return e.phase!=="play"||e.currentQuestionIndex===0?e:{...e,phase:"retreat",wonPrize:e.prizeLadder.values[e.currentQuestionIndex-1]??"0",doubleDipArmed:!1,doubleDipStrikeUsed:!1};case"CLEAR_LIFELINE_RESULT":return{...e,lifelineResult:null};case"APPLY_LIFELINE_FIFTY":return!e.lifelineAvailability.fifty||e.phase!=="play"||e.selectedAnswerDisplayIndex!==null?e:{...e,lifelineAvailability:{...e.lifelineAvailability,fifty:!1},eliminatedAnswerDisplayIndices:t.eliminated};case"APPLY_LIFELINE_PHONE":return!e.lifelineAvailability.phone||e.phase!=="play"||e.selectedAnswerDisplayIndex!==null?e:{...e,lifelineAvailability:{...e.lifelineAvailability,phone:!1},lifelineResult:t.result};case"APPLY_LIFELINE_AUDIENCE":return!e.lifelineAvailability.audience||e.phase!=="play"||e.selectedAnswerDisplayIndex!==null?e:{...e,lifelineAvailability:{...e.lifelineAvailability,audience:!1},lifelineResult:t.result};case"APPLY_LIFELINE_HOST":return!e.lifelineAvailability.host||e.phase!=="play"||e.selectedAnswerDisplayIndex!==null?e:{...e,lifelineAvailability:{...e.lifelineAvailability,host:!1},lifelineResult:t.result};case"APPLY_LIFELINE_SWITCH":{if(!e.lifelineAvailability.switch||e.phase!=="play"||e.selectedAnswerDisplayIndex!==null||t.swapWithIndex===e.currentQuestionIndex||t.swapWithIndex<0||t.swapWithIndex>=e.questions.length)return e;const u=[...e.questions],d=u[e.currentQuestionIndex];return u[e.currentQuestionIndex]=u[t.swapWithIndex],u[t.swapWithIndex]=d,{...e,questions:u,shuffledAnswers:t.nextShuffledAnswers,eliminatedAnswerDisplayIndices:[],lifelineAvailability:{...e.lifelineAvailability,switch:!1},lifelineResult:t.result,doubleDipArmed:!1,doubleDipStrikeUsed:!1}}case"APPLY_LIFELINE_DOUBLE":return!e.lifelineAvailability.double||e.phase!=="play"||e.selectedAnswerDisplayIndex!==null?e:{...e,lifelineAvailability:{...e.lifelineAvailability,double:!1},lifelineResult:t.result,doubleDipArmed:!0,doubleDipStrikeUsed:!1};default:return e}},rn=e=>e.questions.length,Ne=e=>e.questions.length>0?e.questions[e.currentQuestionIndex]:null,sn=e=>e.prizeLadder.values[e.currentQuestionIndex]??"0",Qn=e=>$n(e.currentQuestionIndex,e.questions.length),Xn=e=>On(e.currentQuestionIndex,e.prizeLadder),Kn=(e,t)=>{const n=e.questions[e.currentQuestionIndex];if(!n)return{outcome:"defeat",wonPrize:"0"};const r=e.shuffledAnswers[t],s=n.correct,a=rn(e);return r!==s?e.doubleDipArmed&&!e.doubleDipStrikeUsed?{outcome:"retry",wonPrize:e.wonPrize}:{outcome:"defeat",wonPrize:Xn(e)}:e.currentQuestionIndex===a-1?{outcome:"victory",wonPrize:sn(e)}:{outcome:"correct",wonPrize:e.wonPrize}},Jn=/^[A-Za-z0-9_]+$/;function an(e){if(!e.includes("{")&&!e.includes("}"))return e;let t="",n=0;for(;n<e.length;){const r=e[n];if(r!=="{"){t+=r,n+=1;continue}const s=Zn(e,n);if(!s){t+=r,n+=1;continue}const a=s.inner;if(Jn.test(a)){t+=`{${a}}`,n=s.endIndex+1;continue}const o=an(a);t+=o.replace(/ /g,gn),n=s.endIndex+1}return t}function Ft(e){return ft(e,new WeakMap)}function ft(e,t){if(typeof e=="string")return an(e);if(e==null||typeof e!="object")return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){const s=new Array(e.length);t.set(e,s);for(let a=0;a<e.length;a++)s[a]=ft(e[a],t);return s}const n=Object.getPrototypeOf(e);if(n!==Object.prototype&&n!==null)return e;const r={};t.set(e,r);for(const[s,a]of Object.entries(e))r[s]=ft(a,t);return r}function Zn(e,t){if(e[t]!=="{")return null;let n=0,r=t;for(;r<e.length;){const s=e[r];if(s==="{"&&(n+=1),s==="}"&&(n-=1),n===0)return{inner:e.slice(t+1,r),endIndex:r};if(n<0)return null;r+=1}return null}const er=e=>{const t=`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>${e}</text></svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`},wt=(e,t)=>{var r;const n=e==null?void 0:e.currentTarget;n&&((r=n.dataset)==null?void 0:r.emojiFallbackApplied)!=="true"&&(n.dataset.emojiFallbackApplied="true",n.src=er(t))},tr=(e,t,n)=>({className:r,size:s})=>c.jsx("img",{src:Ke(e,`campaigns/${t}.webp`),alt:n,draggable:!1,loading:"lazy",className:`${Jt} ${r??Zt(s)}`,onError:a=>wt(a,"ðŸŽ¯")}),ot=(e,t,n,r)=>()=>c.jsx("img",{src:Ke(e,t),alt:n,draggable:!1,loading:"lazy",className:"w-full h-full object-contain",onError:s=>wt(s,r)}),nr=e=>()=>c.jsx("img",{src:Ke(e,"coin.webp"),alt:"Coin",draggable:!1,loading:"lazy",className:"w-5 h-5 inline mr-1 object-contain align-[-2px]",onError:t=>wt(t,"ðŸª™")});function rr(e){var n,r,s,a;const t=e.id;return{...e,strings:Ft(e.strings),systemStrings:e.systemStrings?Ft(e.systemStrings):void 0,campaigns:e.campaigns.map(o=>({...o,icon:o.icon??tr(t,o.id,o.name),musicTrack:o.musicTrack??`${o.id}.m4a`,selectSound:o.selectSound??`select-${o.id}.m4a`})),icons:{...e.icons,coin:((n=e.icons)==null?void 0:n.coin)??nr(t)},endIcons:{...e.endIcons,victory:((r=e.endIcons)==null?void 0:r.victory)??ot(t,"victory.webp","Victory","ðŸ†"),defeat:((s=e.endIcons)==null?void 0:s.defeat)??ot(t,"defeat.webp","Defeat","âŒ"),retreat:((a=e.endIcons)==null?void 0:a.retreat)??ot(t,"retreat.webp","Retreat","ðŸ’°")}}}const sr={textPrimary:"text-slate-300",textSecondary:"text-slate-400",textMuted:"text-slate-600",textAccent:"text-slate-200",border:"border-slate-700",borderLight:"border-slate-500",borderHover:"hover:border-slate-500",bgPanelFrom:"#1e293b",bgPanelVia:"#334155",bgPanelTo:"#0f172a",bgHeader:"from-slate-700 via-slate-600 to-slate-700",bgHeaderVia:"#475569",bgButton:"from-slate-600 via-slate-700 to-slate-800",bgAnswer:"from-slate-800 via-slate-900 to-slate-950",bgAnswerHover:"hover:from-slate-700 hover:to-slate-800",bgLifeline:"from-slate-600 to-slate-800",bgPrizeCurrent:"bg-slate-700/60",bgPrizePassed:"bg-slate-800/40",textLifeline:"text-slate-100",borderLifeline:"border-slate-400",shadowAnswer:"hover:shadow-slate-700/50",glow:"rgba(148, 163, 184, 0.5)",glowColor:"#94a3b8",glowSecondary:"#64748b",borderImageColors:"#475569, #1e293b",headerBorderColor:"#1e293b"},on=i.createContext(sr),Ze=()=>i.useContext(on),ar=({theme:e,children:t})=>c.jsx(on.Provider,{value:e,children:t}),or={version:"0.0.0",engine:{icons:[],images:[],sounds:[]},games:{}},ir=e=>{const t=e.toLowerCase();return t.includes("/favicon/")||t.includes("apple-touch-icon")||t.endsWith("site.webmanifest")||t.includes("/meta/")};class lr{constructor(){ve(this,"manifest",null);ve(this,"manifestPromise",null);ve(this,"cache",{images:new Map,audio:new Map});ve(this,"state",{pending:new Map,loaded:new Set,failed:new Set});ve(this,"loadedLevels",new Set)}async loadManifest(){if(this.manifest)return this.manifest;if(this.manifestPromise)return this.manifestPromise;const t=`${dt()}asset-manifest.json`;return this.manifestPromise=xn().then(n=>n?(this.manifest=n,re.assetLoader.info(`Manifest loaded: ${Object.keys(n.games).length} games`),n):(this.manifest=or,re.assetLoader.warn("Asset manifest not found; continuing without preloading",{url:t}),this.manifest)),this.manifestPromise}async getGameIds(){const t=await this.loadManifest();return Object.keys(t.games)}async getGameAssets(t){return(await this.loadManifest()).games[t]||null}findCampaign(t,n){if(t.campaigns[n])return t.campaigns[n];const r=n.toLowerCase();for(const[s,a]of Object.entries(t.campaigns))if(s.toLowerCase()===r)return a;return null}async getAssetsForLevel(t,n,r){const s=await this.loadManifest(),a=[],o=l=>{l&&l.length>0&&a.push(l[0])};switch(t){case"level0":for(const p of Object.values(s.games))p.cardAssets.gameCard?a.push(p.cardAssets.gameCard):p.cardAssets.favicon&&a.push(p.cardAssets.favicon);break;case"level1":if(!n){re.assetLoader.warn("level1 requires gameId");break}const l=s.games[n];if(!l){console.debug(`[AssetLoader] Game not in manifest: ${n}`);break}a.push(...l.level1.icons),a.push(...l.level1.sounds),l.level1.mainMenuMusic&&a.push(l.level1.mainMenuMusic),o(l.level1.startImages);for(const p of Object.values(l.level1.campaignStartImages))o(p);break;case"level1_1":if(!n||!r){re.assetLoader.warn("level1_1 requires gameId and campaignId");break}const u=s.games[n];if(!u)break;const d=this.findCampaign(u,r);if(!d){console.debug(`[AssetLoader] No assets for campaign: ${r}`);break}d.level1_1.music&&a.push(d.level1_1.music),o(d.level1_1.playImages.easy),a.push(...u.voices);break;case"level2":if(!n||!r){re.assetLoader.warn("level2 requires gameId and campaignId");break}const f=s.games[n];if(!f)break;f.level2.defeatMusic&&a.push(f.level2.defeatMusic),f.level2.victoryMusic&&a.push(f.level2.victoryMusic),f.level2.retreatMusic&&a.push(f.level2.retreatMusic),a.push(...f.level2.icons??[]),o(f.level2.endImages.victory),o(f.level2.endImages.defeat),o(f.level2.endImages.retreat);const h=this.findCampaign(f,r);h&&(o(h.level2.playImages.medium),o(h.level2.playImages.hard),o(h.level2.endImages.victory),o(h.level2.endImages.defeat),o(h.level2.endImages.retreat));break}return a.filter(l=>!this.state.loaded.has(l))}async loadLevel(t,n,r,s={}){var l,u;const a=`${t}:${n||""}:${r||""}`;if(this.loadedLevels.has(a)){(l=s.onProgress)==null||l.call(s,1,1);return}const o=await this.getAssetsForLevel(t,n,r);if(o.length===0){this.loadedLevels.add(a),(u=s.onProgress)==null||u.call(s,1,1);return}await this.loadAssets(o,s),this.loadedLevels.add(a)}isLevelLoaded(t,n,r){const s=`${t}:${n||""}:${r||""}`;return this.loadedLevels.has(s)}async loadAssets(t,n={}){const{onProgress:r,continueOnError:s=!0}=n,a=t.filter(x=>!this.state.loaded.has(x));if(a.length===0){r==null||r(1,1);return}let o=0;const l=a.length,u=[],d=[],f=[],h=x=>{const S=x.split("?")[0];return/\.(m4a|ogg|mp3|wav)$/i.test(S)},p=x=>{const S=x.split("?")[0];return/\.(jpg|jpeg|png|webp|gif|svg)$/i.test(S)};for(const x of a){if(h(x)){u.push(x);continue}if(ir(x)){d.push(x);continue}if(p(x)){f.push(x);continue}d.push(x)}const v=[],M=[],P=[];for(const x of f){const S=x.toLowerCase();S.includes("/icons/")?v.push(x):S.includes("/images/")?M.push(x):P.push(x)}const b=async x=>{const S=x.map(async g=>{try{await this.loadAsset(g),o++,r==null||r(o,l)}catch(T){if(re.assetLoader.warn(`Failed to load: ${g}`,{error:T}),this.state.failed.add(g),!s)throw T;o++,r==null||r(o,l)}});await Promise.all(S)};await b(u),await b(d),await b(v),await b(P),await b(M)}async loadAsset(t){if(this.state.loaded.has(t))return;const n=this.state.pending.get(t);if(n)return n;const r=this.resolveUrl(t),s=/\.(jpg|jpeg|png|webp|gif|svg)$/i.test(t),a=/\.(m4a|ogg|mp3|wav)$/i.test(t);let o;s?o=this.loadImage(r,t):a?o=this.loadAudio(r,t):o=fetch(r).then(()=>{this.state.loaded.add(t)}),this.state.pending.set(t,o);try{await o}finally{this.state.pending.delete(t)}}loadImage(t,n){return new Promise((r,s)=>{const a=new Image;a.onload=()=>{this.cache.images.set(n,a),this.state.loaded.add(n),r()},a.onerror=()=>{s(new Error(`Failed to load image: ${t}`))},a.src=t})}loadAudio(t,n){const r=n.includes("/sounds/"),s=n.includes("/music/");return r?fetch(t).then(a=>{if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.arrayBuffer()}).then(async a=>{this.cache.audio.set(n,a),this.state.loaded.add(n),Lt(t,a),await En(t,a)}):s?fetch(t).then(a=>{if(!a.ok)throw new Error(`Failed to preload audio: ${t}`);return a.arrayBuffer()}).then(a=>{this.cache.audio.set(n,a),this.state.loaded.add(n),Lt(t,a)}):(this.state.loaded.add(n),Promise.resolve())}isLoaded(t){return this.state.loaded.has(t)}getImage(t){return this.cache.images.get(t)||null}getAudioBuffer(t){return this.cache.audio.get(t)||null}resolveUrl(t){if(t.startsWith("http://")||t.startsWith("https://"))return t;const n=t.startsWith("/")?t.slice(1):t;return`${dt()}${n}`}getStats(){return{loaded:this.state.loaded.size,pending:this.state.pending.size,failed:this.state.failed.size,cachedImages:this.cache.images.size,cachedAudio:this.cache.audio.size}}clearCache(){this.cache.images.clear(),this.cache.audio.clear(),this.state.loaded.clear(),this.state.failed.clear(),this.loadedLevels.clear()}preloadInBackground(t,n,r){this.loadLevel(t,n,r).catch(s=>{re.assetLoader.warn("Background preload failed",{error:s})})}}const fe=new lr,cr=e=>{const[t,n]=i.useReducer(Un,void 0,()=>nn()),r=i.useMemo(()=>{const I=new Map;for(const m of e.campaigns)I.set(m.id,m);return I},[e.campaigns]),s=i.useMemo(()=>t.selectedCampaignId?r.get(t.selectedCampaignId)??null:null,[r,t.selectedCampaignId]),a=i.useMemo(()=>rn(t),[t]),o=i.useMemo(()=>Ne(t),[t]),l=i.useMemo(()=>sn(t),[t]),u=i.useMemo(()=>Qn(t),[t]),d=i.useMemo(()=>(s==null?void 0:s.theme)??null,[s]),f=i.useMemo(()=>t.lifelineAvailability,[t.lifelineAvailability]),h=i.useCallback(I=>{const m=Nt(e,I.id);m||re.gameState.warn(`No question pool found for campaign: ${I.id}`),n({type:"SELECT_CAMPAIGN",campaignId:I.id,session:m})},[e]);i.useEffect(()=>{e.campaigns.length===1&&t.phase==="start"&&(t.selectedCampaignId||h(e.campaigns[0]))},[e.campaigns,h,t.phase,t.selectedCampaignId]);const p=i.useCallback(()=>{var m,w,E;if(!t.selectedCampaignId)return;const I=Nt(e,t.selectedCampaignId);I||re.gameState.warn(`No question pool found for campaign: ${t.selectedCampaignId}`),n({type:"START_GAME",campaignId:t.selectedCampaignId,session:I,lifelineAvailability:{fifty:e.lifelines.fifty.enabled,phone:e.lifelines.phone.enabled,audience:e.lifelines.audience.enabled,host:((m=e.lifelines.host)==null?void 0:m.enabled)??!1,switch:((w=e.lifelines.switch)==null?void 0:w.enabled)??!1,double:((E=e.lifelines.double)==null?void 0:E.enabled)??!1}})},[e,t.selectedCampaignId]),v=i.useCallback(I=>{const m=I??t.prizeLadder.values[t.prizeLadder.values.length-1]??t.prizeLadder.values[t.currentQuestionIndex]??"0";n({type:"FORCE_WIN",prize:m})},[t.currentQuestionIndex,t.prizeLadder.values]),M=i.useCallback(()=>{n({type:"NEW_GAME"})},[]),P=i.useCallback(async I=>t.selectedAnswerDisplayIndex!==null||t.eliminatedAnswerDisplayIndices.includes(I)?"ignored":(n({type:"ANSWER_SELECTED",displayIndex:I}),new Promise(m=>{setTimeout(()=>{const{outcome:w,wonPrize:E}=Kn(t,I);n(w==="correct"?{type:"ANSWER_RESOLVED",outcome:w,wonPrize:E,nextQuestionIndex:t.currentQuestionIndex+1,nextShuffledAnswers:$e([0,1,2,3])}:{type:"ANSWER_RESOLVED",outcome:w,wonPrize:E}),m(w)},yn)})),[t]),b=i.useCallback(()=>{n({type:"RETREAT"})},[]),x=i.useCallback(()=>{if(!t.lifelineAvailability.fifty||t.selectedAnswerDisplayIndex!==null)return;const I=Ne(t);I&&n({type:"APPLY_LIFELINE_FIFTY",eliminated:_n({correctOriginalIndex:I.correct,shuffledAnswers:t.shuffledAnswers})})},[t]),S=i.useCallback(()=>{if(!t.lifelineAvailability.phone||t.selectedAnswerDisplayIndex!==null)return null;const I=Ne(t);if(!I||e.companions.length===0)return null;const m=qn({correctOriginalIndex:I.correct}),w=e.companions[Math.floor(Math.random()*e.companions.length)],E=I.answers[m.suggestedOriginalIndex],F=m.isConfident?e.strings.companionPhrases.confident:e.strings.companionPhrases.uncertain,L=F[Math.floor(Math.random()*F.length)];return n({type:"APPLY_LIFELINE_PHONE",result:{type:"phone",name:w.name,text:L.replace("{answer}",E)}}),w},[e,t]),g=i.useCallback(()=>{if(!t.lifelineAvailability.audience||t.selectedAnswerDisplayIndex!==null)return;const I=Ne(t);if(!I)return;const m=t.shuffledAnswers.indexOf(I.correct),w=Wn({correctDisplayIndex:m,eliminatedDisplayIndices:t.eliminatedAnswerDisplayIndices});n({type:"APPLY_LIFELINE_AUDIENCE",result:{type:"audience",percentages:w}})},[t]),T=i.useCallback(()=>{if(!t.lifelineAvailability.host||t.selectedAnswerDisplayIndex!==null)return;const I=Ne(t);if(!I)return;const m=t.shuffledAnswers.indexOf(I.correct),{suggestedDisplayIndex:w,confidence:E}=Hn({correctDisplayIndex:m,eliminatedDisplayIndices:t.eliminatedAnswerDisplayIndices}),F=t.shuffledAnswers[w]??I.correct,L=I.answers[F]??"";n({type:"APPLY_LIFELINE_HOST",result:{type:"host",suggestedDisplayIndex:w,answerText:L,confidence:E}})},[t]),A=i.useCallback(()=>{if(!t.lifelineAvailability.switch||t.selectedAnswerDisplayIndex!==null||t.questions.length<2||t.currentQuestionIndex>=t.questions.length-1)return;const I=Gn({currentQuestionIndex:t.currentQuestionIndex,totalQuestions:t.questions.length});I!=null&&n({type:"APPLY_LIFELINE_SWITCH",swapWithIndex:I,nextShuffledAnswers:$e([0,1,2,3]),result:{type:"switch"}})},[t]),y=i.useCallback(()=>{t.lifelineAvailability.double&&t.selectedAnswerDisplayIndex===null&&n({type:"APPLY_LIFELINE_DOUBLE",result:{type:"double",stage:"armed"}})},[t]),C=i.useCallback(()=>{n({type:"CLEAR_LIFELINE_RESULT"})},[]);return{gameState:t.phase,selectedCampaign:s,currentQuestion:t.currentQuestionIndex,totalQuestions:a,selectedAnswer:t.selectedAnswerDisplayIndex,questions:t.questions,prizeLadder:t.prizeLadder,shuffledAnswers:t.shuffledAnswers,eliminatedAnswers:t.eliminatedAnswerDisplayIndices,lifelineResult:t.lifelineResult,lifelineAvailability:f,doubleDipArmed:t.doubleDipArmed,doubleDipStrikeUsed:t.doubleDipStrikeUsed,wonPrize:t.wonPrize,currentQuestionData:o,currentPrize:l,currentDifficulty:u,currentTheme:d,selectCampaign:h,startGame:p,forceWin:v,newGame:M,handleAnswer:P,retreat:b,useLifelineFifty:x,useLifelinePhone:S,useLifelineAudience:g,useLifelineHost:T,useLifelineSwitch:A,useLifelineDouble:y,clearLifelineResult:C}},ur=[".m4a",".ogg"],dr=e=>e.startsWith("http://")||e.startsWith("https://")?e:e.startsWith("/")?wn(e):e,fr=(e,t)=>{if(e.campaigns[t])return e.campaigns[t];const n=t.toLowerCase();for(const[r,s]of Object.entries(e.campaigns))if(r.toLowerCase()===n)return s;return null},pr=async(e,t)=>{const n=await fe.getGameAssets(e);if(!n)return null;const r=fr(n,t);return(r==null?void 0:r.level1_1.music)??null},Se=(e,t)=>{const n=[...e.filter(r=>!!r),...t.flatMap(r=>ur.map(s=>`${r}${s}`))];return Array.from(new Set(n))};function mr(e,{audioElementId:t="bg-music",onDisableAllSounds:n}={}){const[r,s]=i.useState(!1),[a,o]=i.useState(""),l=i.useRef(!1),u=i.useRef(!1),d=i.useRef(!1),f=i.useCallback(()=>document.getElementById(t),[t]),h=i.useCallback((m,w)=>{const E=_e(w);m.src=E??w,m.dataset.logicalSrc=w},[]),p=i.useCallback(m=>{try{m.load()}catch{}},[]);i.useEffect(()=>{(async()=>{const w=Se([e.audio.menuTrack],["menu","MainMenu"]);for(const E of w){if(!E)continue;const F=Pe("music",E,e.id);if(_e(F.specific)||await we(F.specific)){o(F.specific);return}}})()},[e.id,e.audio.menuTrack]);const v=i.useCallback(async m=>{if(!m)return null;if(m.includes("/")){const E=dr(m);return _e(E)||await we(E)?E:null}const w=Pe("music",m,e.id);return _e(w.specific)||await we(w.specific)?w.specific:null},[e.id]),M=i.useCallback(async(m,w=!1)=>{const E=f();if(!E)return;const F=await v(m);if(!F){E.pause(),E.src="",E.dataset.logicalSrc="",o("");return}const j=(E.dataset.logicalSrc||E.src).split("/").pop(),G=F.split("/").pop();if(j===G&&!E.paused||(h(E,F),E.volume=e.audio.musicVolume,o(F),p(E),!(Ae()&&!u.current&&(w||l.current))))return;w&&(l.current=!0,rt(!0));const X=()=>{E.play().catch(Z=>{re.audioPlayer.warn("Music play failed",{error:Z})})};Ye(),Ge(),E.readyState>=2?X():E.addEventListener("canplay",X,{once:!0})},[e.audio.musicVolume,f,v,p,h]),P=i.useCallback(()=>{const m=f();m&&(m.pause(),m.currentTime=0),s(!1),u.current=!0,rt(!1),n==null||n()},[f,n]),b=i.useCallback(()=>{const m=f();if(m){if(r){P();return}u.current=!1,l.current=!0,rt(!0),Ye(),Ge(),a&&(h(m,a),m.volume=e.audio.musicVolume,m.play().catch(()=>{s(!0)})),s(!0)}},[e.audio.musicVolume,a,f,r,n,h,P]);i.useEffect(()=>{if(typeof document>"u"||typeof window>"u")return;const m=()=>{const F=f();if(!F)return;!F.paused&&!F.ended&&(d.current=!0,F.pause(),s(!1))},w=()=>{if(!d.current||u.current||!Ae())return;const F=f();!F||!F.src||(Ye(),Ge(),F.play().then(()=>{s(!0)}).catch(()=>{s(!1)}),d.current=!1)},E=()=>{document.hidden?m():w()};return document.addEventListener("visibilitychange",E),window.addEventListener("pagehide",m),window.addEventListener("pageshow",w),()=>{document.removeEventListener("visibilitychange",E),window.removeEventListener("pagehide",m),window.removeEventListener("pageshow",w)}},[f]);const x=i.useCallback(async(m,w=!1)=>{for(const E of m){if(!E)continue;if(await v(E))return await M(E,w),!0}return!1},[v,M]),S=i.useCallback(()=>{const m=l.current&&!u.current;x(Se([e.audio.menuTrack],["menu","MainMenu"]),m)},[e.audio.menuTrack,x]),g=i.useCallback(()=>{x(Se([e.audio.defeatTrack],["defeat","Defeat"]),!0)},[e.audio.defeatTrack,x]),T=i.useCallback(()=>{x(Se([e.audio.victoryTrack,e.audio.defeatTrack],["victory","defeat","Victory","Defeat"]),!0)},[e.audio.defeatTrack,e.audio.victoryTrack,x]),A=i.useCallback(()=>{x(Se([e.audio.retreatTrack,e.audio.victoryTrack,e.audio.defeatTrack],["retreat","victory","defeat","Retreat","Victory","Defeat"]),!0)},[e.audio.defeatTrack,e.audio.retreatTrack,e.audio.victoryTrack,x]),y=i.useCallback(m=>{if(m==="victory"){T();return}if(m==="retreat"){A();return}g()},[g,A,T]),C=i.useCallback(m=>{(async()=>{const E=await pr(e.id,m.id);await x(Se([E??void 0,m.musicTrack,e.audio.menuTrack],["menu","MainMenu"]),!0)})()},[e.audio.menuTrack,e.id,x]),I=i.useCallback(()=>{const m=f();m&&(m.pause(),m.currentTime=0,s(!1))},[f]);return{isMusicPlaying:r,currentTrack:a,toggleMusic:b,disableAllSounds:P,switchMusicTrack:(m,w)=>{M(m,!!w)},playMainMenu:S,playGameOver:g,playVictory:T,playRetreat:A,playEndMusic:y,playCampaignMusic:C,stopMusic:I}}const it=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,""),hr=e=>{const t=e.split("/");return t[t.length-1]??e},gr=e=>e.replace(/\.[^/.]+$/,""),yr=(e,t)=>{const[n,r]=t;return e.baseKey===n?100:r&&e.baseKey===r?95:n&&n.startsWith(e.baseKey)?85:r&&r.startsWith(e.baseKey)?80:n&&e.baseKey.startsWith(n)?70:r&&e.baseKey.startsWith(r)?65:0},xr=async(e,t)=>{var d;const n=it(t.id),r=it(t.desc??""),s=await fe.getGameAssets(e),o=(((d=s==null?void 0:s.voices)==null?void 0:d.map(hr))??[]).map(f=>({filename:f,baseKey:it(gr(f))}));let l=null;for(const f of o){const h=yr(f,[n,r]);h<=0||(!l||h>l.score)&&(l={filename:f.filename,score:h})}if(l)return l.filename;const u=["m4a","ogg","mp3","wav"];for(const f of u){const h=`${t.id}.${f}`,p=Pe("voices",h,e);if(await we(p.specific))return h}return null};function wr(e){const t=i.useRef(!1),n=i.useRef({campaignSelect:null}),r=i.useRef({campaignSelect:0}),s=i.useCallback(p=>{r.current[p]+=1;const v=n.current[p];v&&(v.stop(),n.current[p]=null)},[]),a=i.useCallback(()=>{t.current||(Ye(),Ge(),t.current=!0)},[]),o=i.useCallback(p=>{if(!Ae())return;a();const v=e.audio.sounds[p];if(v){Ct(v,e.audio.soundVolume);return}Nn(p)},[e.audio.sounds,e.audio.soundVolume,a]),l=i.useCallback(p=>{Ae()&&(a(),Ct(p,e.audio.soundVolume))},[e.audio.soundVolume,a]),u=i.useMemo(()=>({campaignSelect:"answerButton"}),[]),d=i.useCallback((p,v)=>{if(!v)return;s(p);const M=++r.current[p];if(!Ae())return;a(),(async()=>{const b=await kt(v,e.audio.soundVolume);if(r.current[p]!==M){b==null||b.stop();return}if(b){n.current[p]=b;return}o(u[p])})()},[e.audio.soundVolume,o,kt,s,u,a]),f=i.useCallback(async p=>Ae()?(a(),Fn(p,e.audio.voiceVolume)):!1,[e.audio.voiceVolume,a]),h=i.useCallback(async p=>{const v=p.voiceFile;if(v)return f(v);const M=await xr(e.id,p);return M?f(M):!1},[e.id,f]);return{playSoundEffect:o,playSoundFile:l,playTaggedSound:d,stopTaggedSound:s,playCompanionVoiceFile:f,playCompanionVoice:h}}const br=(e,t="bg-music")=>{i.useEffect(()=>{Tn(e.id)},[e.id]);const{playSoundEffect:n,playSoundFile:r,playTaggedSound:s,stopTaggedSound:a,playCompanionVoice:o,playCompanionVoiceFile:l}=wr(e),u=i.useCallback(()=>{a("campaignSelect")},[a]),d=mr(e,{audioElementId:t,onDisableAllSounds:u}),f=i.useCallback(p=>{s("campaignSelect",p)},[s]);i.useEffect(()=>()=>{u()},[u]);const h=i.useCallback(()=>{d.stopMusic(),u()},[d,u]);return{isMusicPlaying:d.isMusicPlaying,currentTrack:d.currentTrack,toggleMusic:d.toggleMusic,disableAllSounds:d.disableAllSounds,playSoundEffect:n,playSoundFile:r,playCampaignSelectSound:f,stopCampaignSelectSound:u,playCompanionVoice:o,playCompanionVoiceFile:l,switchMusicTrack:d.switchMusicTrack,playMainMenu:d.playMainMenu,playGameOver:d.playGameOver,playVictory:d.playVictory,playRetreat:d.playRetreat,playEndMusic:d.playEndMusic,playCampaignMusic:d.playCampaignMusic,stopMusic:h}},vr={effect:null,origin:{x:.5,y:.5},primaryColor:"#FFD700",secondaryColor:"#FF6B6B",intensity:1},Sr=()=>{const[e,t]=i.useState(vr),n=i.useRef(null),r=i.useCallback(()=>{n.current&&(clearTimeout(n.current),n.current=null),t(h=>({...h,effect:null}))},[]),s=i.useCallback((h,p={})=>{r(),requestAnimationFrame(()=>{t({effect:h,origin:p.origin??{x:.5,y:.5},primaryColor:p.primaryColor??"#FFD700",secondaryColor:p.secondaryColor??"#FF6B6B",intensity:p.intensity??1})}),n.current=setTimeout(()=>{t(v=>({...v,effect:null}))},3e3)},[r]),a=i.useCallback(h=>{s("confetti",{origin:h??{x:.5,y:.7},intensity:1.2})},[s]),o=i.useCallback(h=>{s("coins",{origin:h??{x:.5,y:.7},intensity:.8})},[s]),l=i.useCallback(h=>{s("sparks",{origin:h??{x:.5,y:.5},primaryColor:"#FFD700",secondaryColor:"#FFFFFF",intensity:1.8})},[s]),u=i.useCallback(h=>{s("lostSparks",{origin:h??{x:.5,y:.3},intensity:.8})},[s]),d=i.useCallback((h,p)=>{const v=p??"#4ECDC4";s("pulse",{origin:h??{x:.5,y:.5},primaryColor:v,secondaryColor:v,intensity:1})},[s]),f=i.useCallback(()=>{s("fireworks",{origin:{x:.5,y:.3},intensity:1.5})},[s]);return{effectState:e,triggerConfetti:a,triggerCoins:o,triggerSparks:l,triggerLostSparks:u,triggerPulse:d,triggerFireworks:f,clearEffect:r}};function Mr(e,t,n,r={}){const{autoLoad:s=!0,onComplete:a,onError:o}=r,[l,u]=i.useState({isLoading:!1,progress:0,loaded:0,total:0,error:null,isComplete:!1}),d=i.useCallback(async()=>{if(fe.isLevelLoaded(e,t,n)){u({isLoading:!1,progress:100,loaded:1,total:1,error:null,isComplete:!0}),a==null||a();return}u(f=>({...f,isLoading:!0,progress:0,error:null,isComplete:!1}));try{const f=await fe.getAssetsForLevel(e,t,n);if(f.length===0){u({isLoading:!1,progress:100,loaded:0,total:0,error:null,isComplete:!0}),a==null||a();return}u(h=>({...h,total:f.length})),await fe.loadLevel(e,t,n,{onProgress:(h,p)=>{const v=p>0?Math.round(h/p*100):0;u(M=>({...M,loaded:h,total:p,progress:v}))}}),u(h=>({...h,isLoading:!1,progress:100,isComplete:!0})),a==null||a()}catch(f){const h=f instanceof Error?f:new Error(String(f));u(p=>({...p,isLoading:!1,error:h})),o==null||o(h)}},[e,t,n,a,o]);return i.useEffect(()=>{s&&d()},[s,d]),{...l,reload:d}}function jt(e,t,n){var s,a;if(t===0&&n===0)return!0;try{const o=(s=document.elementsFromPoint)==null?void 0:s.call(document,t,n);if(o&&o.length>0)return o.some(u=>e.contains(u));const l=(a=document.elementFromPoint)==null?void 0:a.call(document,t,n);if(l)return e.contains(l)}catch{}const r=e.getBoundingClientRect();return t>=r.left&&t<=r.right&&n>=r.top&&n<=r.bottom}function Ar({disabled:e=!1,initial:t="Idle",enablePointerCapture:n=!0,easeMs:r=120,activateMs:s=140}={}){const[a,o]=i.useState(t),[l,u]=i.useState(!0),d=i.useRef(!0),f=i.useRef(null),h=i.useRef(null),p=i.useRef(null),v=i.useRef(null),M=i.useRef(!1);i.useEffect(()=>{d.current=l},[l]),i.useEffect(()=>{if(a!=="Appear")return;const b=window.setTimeout(()=>o("Idle"),0);return()=>window.clearTimeout(b)},[a]),i.useEffect(()=>()=>{p.current&&window.clearTimeout(p.current),v.current&&window.clearTimeout(v.current)},[]);const P=i.useMemo(()=>{const b=()=>{p.current&&window.clearTimeout(p.current),v.current&&window.clearTimeout(v.current),p.current=null,v.current=null},x=()=>{b(),p.current=window.setTimeout(()=>{o(w=>w!=="Ease"?w:d.current?"Hover":"Idle")},r)},S=()=>{b(),v.current=window.setTimeout(()=>{o(w=>w!=="Activate"?w:d.current?"Hover":"Idle")},s)};return{onPointerEnter:()=>{e||f.current==null&&(u(!0),o(w=>w==="Idle"?"Hover":w))},onPointerLeave:()=>{e||f.current==null&&(u(!1),o(w=>w==="Hover"?"Idle":w))},onPointerDown:w=>{if(!e&&!(w.button!==0&&w.pointerType!=="touch")&&(b(),f.current=w.pointerId,h.current=w.pointerType,u(!0),o("Press"),n))try{w.currentTarget.setPointerCapture(w.pointerId)}catch{}},onPointerMove:w=>{e||a==="Press"&&u(jt(w.currentTarget,w.clientX,w.clientY))},onPointerUp:w=>{if(e||f.current!==w.pointerId)return;if(f.current=null,n)try{w.currentTarget.releasePointerCapture(w.pointerId)}catch{}const F=(h.current??w.pointerType)==="touch",L=F||n?d.current:jt(w.currentTarget,w.clientX,w.clientY);u(L),M.current=F||n?!L:!1,L?(o("Activate"),S()):(o("Ease"),x())},onPointerCancel:w=>{e||f.current===w.pointerId&&(M.current=!0,f.current=null,u(!1),o("Ease"),x())},onLostPointerCapture:()=>{e||f.current!=null&&(M.current=!0,f.current=null,u(!1),o(w=>w==="Press"?"Ease":w),x())}}},[s,e,r,n,a]);return{state:a,isOver:l,eventHandlers:P,suppressNextClickRef:M}}const De=i.forwardRef(({disabled:e=!1,className:t,style:n,onClick:r,onPointerEnter:s,onPointerLeave:a,onPointerDown:o,onPointerMove:l,onPointerUp:u,onPointerCancel:d,onLostPointerCapture:f,fsmInitial:h="Idle",enablePointerCapture:p=!0,easeMs:v,activateMs:M,buttonType:P="button",glareRestart:b="none",...x},S)=>{const g=Ar({disabled:e,initial:h,enablePointerCapture:p,easeMs:v,activateMs:M}),[T,A]=i.useState("a"),y=i.useCallback(()=>{A(m=>m==="a"?"b":"a")},[]),C=i.useCallback(m=>{if(g.suppressNextClickRef.current){g.suppressNextClickRef.current=!1,m.preventDefault(),m.stopPropagation();return}r==null||r(m)},[g.suppressNextClickRef,r]),I=n??{};return c.jsx("button",{ref:S,type:P,disabled:e,"data-btn-state":g.state,"data-btn-over":g.isOver?"true":"false","data-glare-phase":T,className:t,style:I,onClick:C,onPointerEnter:m=>{!e&&b!=="none"&&y(),g.eventHandlers.onPointerEnter(m),s==null||s(m)},onPointerLeave:m=>{g.eventHandlers.onPointerLeave(m),a==null||a(m)},onPointerDown:m=>{!e&&b==="pointer"&&(m.button===0||m.pointerType==="touch")&&y(),g.eventHandlers.onPointerDown(m),o==null||o(m)},onPointerMove:m=>{g.eventHandlers.onPointerMove(m),l==null||l(m)},onPointerUp:m=>{!e&&b==="pointer"&&(m.button===0||m.pointerType==="touch")&&y(),g.eventHandlers.onPointerUp(m),u==null||u(m)},onPointerCancel:m=>{g.eventHandlers.onPointerCancel(m),d==null||d(m)},onLostPointerCapture:m=>{g.eventHandlers.onLostPointerCapture(m),f==null||f(m)},...x})});De.displayName="BaseButton";function ln({children:e,theme:t,disabled:n,className:r="",onClick:s,onPointerDown:a}){const o=i.useRef(null),l=i.useRef(null),[u,d]=i.useState(1);return i.useLayoutEffect(()=>{const f=o.current,h=l.current;if(!f||!h)return;let p=null,v=!1;const M=()=>{p!=null&&window.cancelAnimationFrame(p),p=window.requestAnimationFrame(()=>{p=null;const x=f.clientWidth,S=h.scrollWidth;if(x<=0||S<=0)return;const g=Math.min(1,(x-1)/S),T=Math.max(.6,g);d(A=>Math.abs(A-T)<.002?A:T)})};M();const P=new ResizeObserver(()=>M());P.observe(f);const b=document==null?void 0:document.fonts;return b!=null&&b.ready&&b.ready.then(()=>{v||M()}),()=>{v=!0,P.disconnect(),p!=null&&window.cancelAnimationFrame(p)}},[e]),c.jsx("div",{ref:o,className:"w-full flex justify-center overflow-visible",children:c.jsx("div",{className:"inline-block overflow-visible",style:{transform:`scale(${u.toFixed(4)})`,transformOrigin:"center"},children:c.jsx(De,{ref:l,disabled:n,onClick:s,onPointerDown:a,enablePointerCapture:!0,glareRestart:"pointer",className:`glare action-btn px-8 py-3 font-bold text-lg tracking-wide border-4 ${r}`,style:{"--btn-glow":t.glow,touchAction:"manipulation",boxShadow:n?"none":`0 5px 20px rgba(0, 0, 0, 0.3), 0 0 25px ${t.glow}`,borderStyle:"ridge",textShadow:n?"none":"0 2px 4px rgba(0,0,0,0.8)"},children:e})})})}function Pr({children:e,disabled:t,className:n,onClick:r}){return c.jsx(De,{disabled:t,onClick:r,className:`glare answer-btn ${n}`,style:{borderStyle:"ridge"},children:e})}function ge({icon:e,label:t,disabled:n,className:r,glow:s,boxShadow:a,onClick:o,title:l,ariaLabel:u}){const d=!!t;return c.jsx(De,{disabled:n,onClick:o,title:l,"aria-label":u??l,className:`glare lifeline-btn ${r}`,style:{borderStyle:"ridge","--lifeline-glow":s,boxShadow:a},children:d?c.jsxs("span",{className:"flex items-center gap-2 justify-center",children:[c.jsx("span",{className:"w-6 h-6 flex items-center justify-center",children:e}),c.jsx("span",{className:"text-left",children:t})]}):c.jsx("span",{className:"flex items-center justify-center",children:c.jsx("span",{className:"w-7 h-7 flex items-center justify-center text-2xl",children:e})})})}function Ir({title:e,onClick:t,children:n}){return c.jsx(De,{onClick:t,className:"absolute top-3 right-3 text-2xl hover:scale-110 transition-transform",title:e,style:{filter:"drop-shadow(0 0 6px rgba(0,0,0,0.6))"},children:n})}const be=({children:e,className:t="",variant:n="default"})=>{const r=Ze(),s=n==="headless"?"rounded-md":"";return c.jsx("div",{className:`bg-gradient-to-b border-4 transition-all duration-300 ${s} ${t}`,style:{background:`linear-gradient(to bottom, ${r.bgPanelFrom}, ${r.bgPanelVia}, ${r.bgPanelTo})`,boxShadow:`inset 0 2px 8px ${r.glow}, 0 0 30px rgba(0,0,0,0.8), 0 4px 20px ${r.glow}`,borderImage:`linear-gradient(180deg, ${r.borderImageColors}) 1`,borderStyle:"ridge"},children:e})},Ce=({children:e,align:t="center"})=>{const n=Ze(),r=!!n.isLight,s=n.textHeader??n.textSecondary,a=n.panelHeaderTextShadow??(r?"0 1px 2px rgba(15, 23, 42, 0.28)":"0 1px 3px rgba(0,0,0,0.8)"),o=t==="between"?"flex justify-between items-center":"text-center";return c.jsx("div",{className:`${n.headerGradientClass??"bg-gradient-to-r"} ${n.bgHeader} px-3 py-2 border-b-4 transition-all duration-300 ${o} ${s} text-sm tracking-wide`,style:{boxShadow:`0 2px 10px ${n.glow}`,textShadow:a,borderStyle:"solid",borderBottomColor:n.headerBorderColor},children:e})},bt=()=>c.jsx("span",{className:"mr-1",children:"ðŸª™"}),Tr=()=>c.jsx("span",{className:"inline-block",children:"ðŸ“ž"}),Er=()=>c.jsx("span",{className:"inline-block text-yellow-500","aria-hidden":"true",children:"â˜…"}),Lr=()=>c.jsx("div",{className:"w-16 h-16 mx-auto flex items-center justify-center text-5xl",children:"ðŸŽ§"}),Cr=()=>c.jsx("div",{className:"w-64 h-64 mx-auto flex items-center justify-center text-[10rem] leading-none",children:"ðŸ†"}),kr=()=>c.jsx("div",{className:"w-64 h-64 mx-auto flex items-center justify-center text-[10rem] leading-none",children:"âŒ"}),Rr=()=>c.jsx("div",{className:"w-64 h-64 mx-auto flex items-center justify-center text-[10rem] leading-none",children:"ðŸ’°"});function Nr({config:e,theme:t,variant:n,wonPrize:r,iconRef:s,onNewGame:a,onActionButtonPress:o}){var M;const l=i.useRef(null),u=((M=e.icons)==null?void 0:M.coin)||bt,d=i.useMemo(()=>{var b,x,S;const P=(g,T)=>{if(g){const A=g;return c.jsx(A,{})}return T};return n==="victory"?P((b=e.endIcons)==null?void 0:b.victory,c.jsx(Cr,{})):n==="defeat"?P((x=e.endIcons)==null?void 0:x.defeat,c.jsx(kr,{})):P((S=e.endIcons)==null?void 0:S.retreat,c.jsx(Rr,{}))},[e.endIcons,n]),f=i.useMemo(()=>n==="victory"?e.strings.victoryText:n==="defeat"?e.strings.defeatText:e.strings.retreatText,[e.strings,n]),h=i.useMemo(()=>n==="victory"?e.strings.victoryHeader:n==="defeat"?e.strings.defeatHeader:e.strings.retreatHeader,[e.strings,n]),p=n==="victory"?"text-yellow-400":n==="defeat"?"text-red-400":t.textPrimary,v=n==="victory"?"0 0 25px #facc15, 0 2px 8px #000":n==="defeat"?"0 0 25px #ef4444, 0 2px 8px #000":`0 0 25px ${t.glowColor}, 0 2px 8px #000`;return i.useLayoutEffect(()=>{const P=l.current;if(!P)return;let b=null,x=!1;const S=()=>{b!=null&&window.cancelAnimationFrame(b),b=window.requestAnimationFrame(()=>{b=null,P.style.fontSize="";const A=window.getComputedStyle(P),y=Number.parseFloat(A.fontSize);if(!Number.isFinite(y)||y<=0)return;const C=()=>{var Z,R;const j=document.createRange();j.selectNodeContents(P);const G=Array.from(j.getClientRects());if((Z=j.detach)==null||Z.call(j),G.length===0)return 0;let te=1,X=((R=G[0])==null?void 0:R.top)??0;for(const $ of G)Math.abs($.top-X)>.5&&(te+=1,X=$.top);return te},I=2,m=()=>!(C()>I||P.clientWidth>0&&P.scrollWidth>P.clientWidth+.5);if(m())return;const w=Math.max(11,y*.6);let E=w,F=y,L=w;for(let j=0;j<8;j+=1){const G=(E+F)/2;P.style.fontSize=`${G.toFixed(2)}px`,m()?(L=G,E=G):F=G}P.style.fontSize=`${L.toFixed(2)}px`})};S();const g=new ResizeObserver(()=>S());g.observe(P);const T=document==null?void 0:document.fonts;return T!=null&&T.ready&&T.ready.then(()=>{x||S()}),()=>{x=!0,g.disconnect(),b!=null&&window.cancelAnimationFrame(b)}},[f]),c.jsxs(be,{className:"p-1 animate-slide-in stagger-2",children:[c.jsx(Ce,{children:h}),c.jsxs("div",{className:"text-center py-3 px-4 flex flex-col sm:py-4",children:[c.jsx("div",{ref:s,className:`animate-pop-in stagger-3 end-screen-icon ${Sn}`,children:d}),c.jsx("p",{ref:l,className:`text-2xl font-bold mt-2 mb-4 tracking-wide animate-slide-in stagger-4 ${p}`,style:{textShadow:v},children:f}),c.jsxs("div",{className:"flex items-center justify-center gap-1 sm:gap-2 text-yellow-300 font-bold animate-prize stagger-5 max-w-full text-[clamp(0.85rem,4.4vw,1.25rem)] whitespace-nowrap",children:[u&&c.jsx(u,{}),c.jsxs("span",{children:[r," ",e.prizes.currency]})]}),c.jsx("div",{className:"mt-3 pt-2 sm:pt-4 animate-pop-in stagger-6",children:c.jsx(ln,{theme:t,onClick:a,onPointerDown:P=>o(P),className:`bg-gradient-to-b ${t.bgButton} text-white ${t.borderLight}`,children:e.strings.newGameButton})})]})]})}function Fr({config:e,gameState:t,onNewGame:n,onActionButtonPress:r,theme:s,effects:a}){const{gameState:o,wonPrize:l}=t,d=(Number.parseInt(l.replace(/\s+/g,""),10)||0)>0,[f,h]=i.useState(o==="defeat"?1:0),p=i.useRef(o),v=i.useRef(null),M=i.useCallback(()=>{const S=()=>(Math.random()-.5)*2*.005;if(v.current){const g=v.current.getBoundingClientRect(),T=g.left+g.width/2,A=g.top+g.height/2;return{x:T/window.innerWidth+S(),y:A/window.innerHeight+S()}}return{x:.5+S(),y:.3+S()}},[]);i.useEffect(()=>{if(o==="victory"||o==="retreat"&&d){const x=setTimeout(()=>{a==null||a.triggerCoins(M());const g=()=>{const T=500+Math.random()*3200;return setTimeout(()=>{a==null||a.triggerCoins(M()),S=g()},T)};S=g()},500);let S;return()=>{clearTimeout(x),clearTimeout(S)}}},[o,d,M]),i.useEffect(()=>{o==="defeat"&&p.current!=="defeat"&&h(x=>x+1),p.current=o},[o]),i.useEffect(()=>{if(o==="defeat"&&e.enableLostSparks){const x=setTimeout(()=>{a==null||a.triggerLostSparks(M());const g=()=>{const T=400+Math.random()*2500;return setTimeout(()=>{a==null||a.triggerLostSparks(M()),S=g()},T)};S=g()},500);let S;return()=>{clearTimeout(x),clearTimeout(S)}}},[o,M]);const P=o==="victory"?"victory":o==="defeat"?"defeat":"retreat",b=o==="defeat"?`defeat-${f}`:o;return c.jsx(Nr,{config:e,theme:s,variant:P,wonPrize:l,iconRef:v,onNewGame:n,onActionButtonPress:r},b)}function jr({answers:e,correctAnswerIndex:t,shuffledAnswers:n,eliminatedAnswers:r,selectedAnswer:s,preventCorrectRevealOnWrongSelection:a=!1,theme:o,answerIndexRefs:l,onAnswerClick:u}){const d=f=>{const h="relative px-4 py-3 text-left transition-all duration-300 cursor-pointer text-sm border-4 ",v=s!==null&&f===s?" answer-btn--selected":"";if(r.includes(f))return h+"opacity-30 cursor-not-allowed bg-stone-950 text-stone-700 border-stone-900";const M=n[f];if(s!==null){const x=n[s]===t||!a;return M===t&&x?h+"bg-gradient-to-br from-emerald-800 to-emerald-950 text-emerald-200 border-emerald-500 shadow-xl animate-pulse"+v:f===s&&M!==t?h+"bg-gradient-to-br from-red-900 to-red-950 text-red-300 border-red-600 shadow-lg animate-pulse"+v:h+"opacity-30 cursor-not-allowed bg-stone-950 text-stone-700 border-stone-900"}return h+`bg-gradient-to-b ${o.bgAnswer} ${o.textSecondary} ${o.border} ${o.borderHover} ${o.bgAnswerHover} ${o.textAccent} hover:shadow-lg ${o.shadowAnswer}`};return c.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:n.map((f,h)=>c.jsxs(Pr,{onClick:p=>u(h,p),disabled:s!==null||r.includes(h),className:d(h),children:[c.jsxs("span",{ref:p=>{l.current[h]=p},className:`${o.textPrimary} mr-2 font-bold`,children:["[",["A","B","C","D"][h],"]"]}),e[f]]},h))})}function $r({selectedAnswer:e,lifelineAvailability:t,lifelineConfigFifty:n,lifelineConfigPhone:r,lifelineConfigAudience:s,lifelineConfigHost:a,lifelineConfigSwitch:o,lifelineConfigDouble:l,onFifty:u,onPhone:d,onAudience:f,onHost:h,onSwitch:p,onDouble:v}){const M=Ze(),P="px-3 py-2 text-sm border-3 h-12 w-full min-w-[132px] flex items-center justify-center gap-2",b=M.isLight?"bg-gradient-to-b from-white/85 via-slate-100/75 to-white/85 border-slate-300 text-slate-400 cursor-not-allowed":"bg-stone-950 border-stone-800 text-stone-600 cursor-not-allowed",x=(y,C)=>!!(y!=null&&y.enabled)&&!!C,S=e===null,A=3+((a!=null&&a.enabled&&h?1:0)+(o!=null&&o.enabled&&p?1:0)+(l!=null&&l.enabled&&v?1:0))===4?"lg:grid-cols-4":"lg:grid-cols-3";return c.jsx(be,{className:"p-1 mt-1 animate-slide-in stagger-3",children:c.jsxs("div",{className:`grid gap-2 p-3 justify-center w-full grid-cols-1 sm:grid-cols-2 ${A}`,children:[c.jsx(ge,{onClick:u,disabled:!t.fifty||!S,className:`${P} ${t.fifty&&S?"bg-gradient-to-b from-orange-700 to-orange-900 border-orange-500 text-orange-100":b}`,glow:"rgba(249, 115, 22, 0.5)",boxShadow:t.fifty&&S?"0 0 15px rgba(249, 115, 22, 0.4)":"none",icon:n.icon,label:n.name}),c.jsx(ge,{onClick:d,disabled:!t.phone||!S,className:`${P} ${t.phone&&S?"bg-gradient-to-b from-blue-700 to-blue-900 border-blue-500 text-blue-100":b}`,glow:"rgba(59, 130, 246, 0.5)",boxShadow:t.phone&&S?"0 0 15px rgba(59, 130, 246, 0.4)":"none",icon:r.icon,label:r.name}),c.jsx(ge,{onClick:f,disabled:!t.audience||!S,className:`${P} ${t.audience&&S?"bg-gradient-to-b from-teal-700 to-teal-900 border-teal-500 text-teal-100":b}`,glow:"rgba(20, 184, 166, 0.5)",boxShadow:t.audience&&S?"0 0 15px rgba(20, 184, 166, 0.4)":"none",icon:s.icon,label:s.name}),(a==null?void 0:a.enabled)&&h&&c.jsx(ge,{onClick:h,disabled:!x(a,t.host)||!S,className:`${P} ${x(a,t.host)&&S?"bg-gradient-to-b from-purple-700 to-purple-950 border-purple-500 text-purple-100":b}`,glow:"rgba(168, 85, 247, 0.5)",boxShadow:x(a,t.host)&&S?"0 0 15px rgba(168, 85, 247, 0.4)":"none",icon:a.icon,label:a.name}),(o==null?void 0:o.enabled)&&p&&c.jsx(ge,{onClick:p,disabled:!x(o,t.switch)||!S,className:`${P} ${x(o,t.switch)&&S?"bg-gradient-to-b from-fuchsia-700 to-fuchsia-950 border-fuchsia-500 text-fuchsia-100":b}`,glow:"rgba(217, 70, 239, 0.5)",boxShadow:x(o,t.switch)&&S?"0 0 15px rgba(217, 70, 239, 0.4)":"none",icon:o.icon,label:o.name}),(l==null?void 0:l.enabled)&&v&&c.jsx(ge,{onClick:v,disabled:!x(l,t.double)||!S,className:`${P} ${x(l,t.double)&&S?"bg-gradient-to-b from-rose-700 to-rose-950 border-rose-500 text-rose-100":b}`,glow:"rgba(244, 63, 94, 0.5)",boxShadow:x(l,t.double)&&S?"0 0 15px rgba(244, 63, 94, 0.4)":"none",icon:l.icon,label:l.name})]})})}function Dr({theme:e,icon:t,senderLabel:n,name:r,text:s}){return c.jsxs("div",{children:[c.jsxs("p",{className:`${e.textAccent} text-xs mb-1 italic`,children:[c.jsx(t,{})," ",n," ",r]}),c.jsx("p",{className:`${e.textAccent} italic`,children:s})]})}function Br({theme:e,percentages:t,label:n}){return c.jsxs("div",{children:[n&&c.jsx("p",{className:`text-xs mb-2 ${e.textAccent}`,children:n}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:t.map((r,s)=>c.jsxs("div",{className:"text-center",children:[c.jsx("div",{className:`h-16 bg-black border-2 ${e.border} relative overflow-hidden`,style:{borderStyle:"inset"},children:c.jsx("div",{className:`absolute bottom-0 left-0 right-0 bg-gradient-to-t ${e.bgLifeline} transition-all duration-500`,style:{height:`${r}%`}})}),c.jsxs("span",{className:`text-xs ${e.textAccent}`,children:["[",["A","B","C","D"][s],"] ",r,"%"]})]},s))})]})}function zr({theme:e,icon:t,result:n}){const r=["A","B","C","D"][n.suggestedDisplayIndex]??"?",s=n.confidence==="confident"?"Ð£Ð²ÐµÑ€ÐµÐ½Ð½Ð¾":"ÐÐµ ÑƒÐ²ÐµÑ€ÐµÐ½";return c.jsxs("div",{className:"flex items-start gap-3",children:[c.jsx("div",{className:"text-4xl leading-none mt-0.5",children:t}),c.jsxs("div",{className:"space-y-1",children:[c.jsx("div",{className:`text-xs uppercase tracking-wide ${e.textAccent}`,children:s}),c.jsxs("div",{className:`text-sm ${e.textAccent}`,children:["Ð”ÑƒÐ¼Ð°ÑŽ, Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚: ",c.jsxs("span",{className:"font-bold",children:["[",r,"]"]})]}),c.jsx("div",{className:`text-sm ${e.textAccent} italic truncate max-w-[520px]`,children:n.answerText})]})]})}function Or({theme:e,icon:t,text:n}){return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"text-4xl leading-none",children:t}),c.jsx("div",{className:`text-sm ${e.textAccent}`,children:n})]})}function _r({theme:e,icon:t,text:n}){return c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("div",{className:"text-4xl leading-none",children:t}),c.jsx("div",{className:`text-sm ${e.textAccent}`,children:n})]})}function Wr({lifelineResult:e,config:t,theme:n,PhoneLifelineIcon:r}){var b,x,S;const[a,o]=i.useState(e),[l,u]=i.useState(!1),d=(g,T)=>!g&&!T?!0:!g||!T||g.type!==T.type?!1:g.type==="phone"&&T.type==="phone"?g.name===T.name&&g.text===T.text:g.type==="audience"&&T.type==="audience"?g.percentages.length===T.percentages.length&&g.percentages.every((A,y)=>A===T.percentages[y]):g.type==="host"&&T.type==="host"?g.suggestedDisplayIndex===T.suggestedDisplayIndex&&g.answerText===T.answerText&&g.confidence===T.confidence:g.type==="switch"&&T.type==="switch"?!0:g.type==="double"&&T.type==="double"?g.stage===T.stage:!1;if(i.useEffect(()=>{if(d(e,a)){u(!1);return}if(!a){e&&o(e),u(!1);return}u(!0);const g=setTimeout(()=>{o(e),u(!1)},140);return()=>clearTimeout(g)},[e,a]),!a)return null;const f=(()=>{var g,T,A;return a.type==="phone"?t.strings.lifelinePhoneHeader:a.type==="audience"?t.strings.lifelineAudienceHeader:a.type==="host"?((g=t.lifelines.host)==null?void 0:g.name)??"ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð²ÐµÐ´ÑƒÑ‰ÐµÐ³Ð¾":a.type==="switch"?((T=t.lifelines.switch)==null?void 0:T.name)??"Ð—Ð°Ð¼ÐµÐ½Ð° Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°":((A=t.lifelines.double)==null?void 0:A.name)??"ÐŸÑ€Ð°Ð²Ð¾ Ð½Ð° Ð¾ÑˆÐ¸Ð±ÐºÑƒ"})(),h=t.strings.lifelineSenderLabel,p=t.strings.lifelineAudienceLabel,v=t.strings.lifelineSwitchText??"Ð’Ð¾Ð¿Ñ€Ð¾Ñ Ð·Ð°Ð¼ÐµÐ½Ñ‘Ð½. ÐŸÑ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼.",M=t.strings.lifelineDoubleArmedText??"ÐœÐ¾Ð¶Ð½Ð¾ Ð¾ÑˆÐ¸Ð±Ð¸Ñ‚ÑŒÑÑ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð· â€” Ð¸ Ð²Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð½Ð¾.",P=t.strings.lifelineDoubleUsedText??"ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð°Ñ… Ð¿Ñ€Ð¸Ð½ÑÑ‚. Ð’Ñ‹Ð±ÐµÑ€Ð¸ ÐµÑ‰Ñ‘ Ñ€Ð°Ð·.";return c.jsxs(be,{className:`p-1 mt-1 ${l?"animate-dust-out":"animate-slide-in stagger-4"}`,children:[c.jsx(Ce,{children:f}),c.jsxs("div",{className:"p-3",children:[a.type==="phone"&&c.jsx(Dr,{theme:n,icon:r,senderLabel:h,name:a.name,text:a.text}),a.type==="audience"&&c.jsx(Br,{theme:n,percentages:a.percentages,label:p}),a.type==="host"&&c.jsx(zr,{theme:n,icon:((b=t.lifelines.host)==null?void 0:b.icon)??"ðŸŽ­",result:a}),a.type==="switch"&&c.jsx(Or,{theme:n,icon:((x=t.lifelines.switch)==null?void 0:x.icon)??"ðŸ”",result:a,text:v}),a.type==="double"&&c.jsx(_r,{theme:n,icon:((S=t.lifelines.double)==null?void 0:S.icon)??"ðŸŽ¯",result:a,text:a.stage==="armed"?M:P})]})]})}function qr({prizeladderHeader:e,prizes:t,guaranteedPrizes:n,currentQuestion:r,totalQuestions:s,theme:a,StarIcon:o,retreatConfig:l,retreatDisabled:u,onRetreat:d}){const f="px-3 py-2 text-sm border-3 h-12 w-full flex items-center justify-center gap-2",h=a.prizeTextCurrent??a.textSecondary,p=a.prizeTextPassed??a.textMuted,v=a.prizeTextFuture??"text-stone-300",M=a.prizeBgGuaranteed??"bg-yellow-950/40",P=a.prizeTextGuaranteed??"text-yellow-600",b=a.prizeBorderGuaranteed??"border-yellow-700",x=(S,g="")=>c.jsx("span",{className:`inline-flex items-center gap-0.5 ${g}`,"aria-hidden":"true",children:Array.from({length:S}).map((T,A)=>c.jsx(o,{},A))});return c.jsxs(be,{className:"p-1 h-fit",children:[c.jsx(Ce,{children:e}),c.jsx("div",{className:"p-2 space-y-1",children:[...t].reverse().map((S,g)=>{const T=s-1-g,A=T+1,y=n.includes(T),C=T===r,I=T<r,m=T/s,w=m<1/3?1:m<2/3?2:3;return c.jsxs("div",{className:`text-xs px-2 py-1 relative transition-all border-l-4 prize-row ${C?`${a.bgPrizeCurrent} ${h} ${a.prizeBorderCurrent??a.borderLight} shadow-lg prize-row-current`:I?`${a.bgPrizePassed} ${p} ${a.prizeBorderPassed??a.border}`:y?`${M} ${P} ${b}`:`${v} border-stone-700`}`,"data-active":C?"true":"false","data-passed":I?"true":"false",style:C?{boxShadow:`0 0 15px ${a.prizeGlowCurrent??a.glow}`,borderStyle:"solid"}:{borderStyle:"solid"},children:[c.jsx("span",{className:"prize-number font-mono",children:String(A).padStart(2,"0")}),c.jsx("span",{className:"prize-value font-mono",children:S}),c.jsxs("span",{className:"prize-stars",children:[y&&c.jsx("span",{title:`${w}â˜…`,children:x(w)}),!y&&x(3,"opacity-0")]})]},T)})}),c.jsx("div",{className:"p-2 pt-1",children:c.jsx(ge,{onClick:d,disabled:u,className:`${f} ${u?"bg-stone-950 border-stone-800 text-stone-600 cursor-not-allowed":"bg-gradient-to-b from-yellow-700 to-yellow-900 border-yellow-600 text-yellow-100"}`,glow:"rgba(234, 179, 8, 0.5)",boxShadow:u?"none":"0 0 15px rgba(234, 179, 8, 0.4)",icon:l.icon,label:l.name})})]})}function Hr({headerText:e,prizeText:t,questionText:n,CoinIcon:r,theme:s}){const a=s.textHeader??s.textSecondary;return c.jsxs(be,{className:"p-1",children:[c.jsxs(Ce,{align:"between",children:[c.jsx("span",{className:"flex items-baseline gap-2 font-semibold uppercase tracking-wide",children:e}),c.jsxs("span",{className:`${a} font-bold flex items-center gap-1`,children:[c.jsx(r,{}),t]})]}),c.jsx("div",{className:"p-4",children:c.jsx("p",{className:`${s.textAccent} text-base leading-relaxed`,children:n})})]})}function Gr({config:e,gameState:t,audio:n,theme:r,effects:s,onNewGame:a}){var B,O,ee;const{currentQuestion:o,totalQuestions:l,questions:u,prizeLadder:d,shuffledAnswers:f,eliminatedAnswers:h,selectedAnswer:p,lifelineResult:v,lifelineAvailability:M,doubleDipArmed:P,doubleDipStrikeUsed:b,handleAnswer:x,useLifelineFifty:S,useLifelinePhone:g,useLifelineAudience:T,useLifelineHost:A,useLifelineSwitch:y,useLifelineDouble:C,retreat:I}=t,m=u[o],w=d.values,E=d.guaranteed,F=i.useRef([]),L=((B=e.icons)==null?void 0:B.coin)||bt,j=((O=e.icons)==null?void 0:O.lifelinePhone)||Tr,G=((ee=e.icons)==null?void 0:ee.star)||Er,te=e.lifelines.fifty,X=e.lifelines.phone,Z=e.lifelines.audience,R=e.lifelines.host,$=e.lifelines.switch,W=e.lifelines.double,Q=e.actions.retreat,J=H=>{const ae=H.getBoundingClientRect(),oe=document.getElementById("effects-canvas"),le=oe==null?void 0:oe.getBoundingClientRect(),St=(le==null?void 0:le.width)||window.innerWidth||1,xe=(le==null?void 0:le.height)||window.innerHeight||1,Be=(le==null?void 0:le.left)||0,et=(le==null?void 0:le.top)||0;return{x:Math.min(1,Math.max(0,(ae.left+ae.width/2-Be)/St)),y:Math.min(1,Math.max(0,(ae.top+ae.height/2-et)/xe))}},Y=(H,ae)=>{s==null||s.triggerPulse(J(H),ae)},N=async(H,ae)=>{n.playSoundEffect("answerButton");const oe=await x(H);oe==="correct"?n.playSoundEffect("correct"):oe==="victory"?(n.playSoundEffect("victory"),n.playVictory()):oe==="retry"?n.playSoundEffect("lifelineDouble"):oe==="defeat"&&(n.playSoundEffect("defeat"),n.playGameOver())},D=H=>{n.playSoundEffect("lifelineFifty"),Y(H.currentTarget,"#f97316"),S()},_=async H=>{const ae=g();if(ae){Y(H.currentTarget,"#3b82f6");let oe=!1;oe=await n.playCompanionVoice(ae),oe||n.playSoundEffect("lifelinePhone")}},k=H=>{n.playSoundEffect("lifelineAudience"),Y(H.currentTarget,"#14b8a6"),T()},q=H=>{n.playSoundEffect("lifelineHost"),Y(H.currentTarget,"#a855f7"),A()},z=H=>{n.playSoundEffect("lifelineSwitch"),Y(H.currentTarget,"#d946ef"),y()},V=H=>{n.playSoundEffect("lifelineDouble"),Y(H.currentTarget,"#f43f5e"),C()},U=H=>{if(n.playSoundEffect("retreatButton"),o===0){a();return}n.playRetreat(),I()},K=o+1,ne=String(K).padStart(2,"0"),ie="#{n}".replace("{n}",`Â ${ne}`);return c.jsxs("div",{className:"grid md:grid-cols-4 gap-3 animate-slide-in stagger-2",children:[c.jsxs("div",{className:"md:col-span-3 space-y-3",children:[c.jsx(Hr,{headerText:ie,prizeText:w[o],questionText:m.question,CoinIcon:L,theme:r}),c.jsx(jr,{answers:m.answers,correctAnswerIndex:m.correct,shuffledAnswers:f,eliminatedAnswers:h,selectedAnswer:p,preventCorrectRevealOnWrongSelection:P&&!b,theme:r,answerIndexRefs:F,onAnswerClick:N}),c.jsx($r,{selectedAnswer:p,lifelineAvailability:M,lifelineConfigFifty:te,lifelineConfigPhone:X,lifelineConfigAudience:Z,lifelineConfigHost:R,lifelineConfigSwitch:$,lifelineConfigDouble:W,onFifty:D,onPhone:_,onAudience:k,onHost:q,onSwitch:z,onDouble:V}),c.jsx(Wr,{lifelineResult:v,config:e,theme:r,PhoneLifelineIcon:j})]}),c.jsx(qr,{prizeladderHeader:e.strings.prizeladderHeader,prizes:w,guaranteedPrizes:E,currentQuestion:o,totalQuestions:l,theme:r,StarIcon:G,retreatConfig:Q,retreatDisabled:p!==null,onRetreat:U})]})}const $t=["#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE"],pt=["#FFD700","#FFA500","#FFFF00","#FFFFFF"],Yr=(e,t,n,r)=>{const s=Math.random()*Math.PI*2,a=8+Math.random()*12;return{x:n*e,y:r*t,vx:Math.cos(s)*a*(.5+Math.random()),vy:Math.sin(s)*a-10-Math.random()*5,size:8+Math.random()*8,color:$t[Math.floor(Math.random()*$t.length)],alpha:1,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,life:0,maxLife:150+Math.random()*100,type:Math.random()>.5?"rect":"circle"}},Vr=(e,t,n,r)=>{const s=Math.random()*Math.PI*2,a=3+Math.random()*6;return{x:n*e,y:r*t,vx:Math.cos(s)*a,vy:Math.sin(s)*a,size:2+Math.random()*4,color:pt[Math.floor(Math.random()*pt.length)],alpha:1,rotation:0,rotationSpeed:0,life:0,maxLife:40+Math.random()*30,type:"circle"}},Ur=(e,t,n,r,s)=>{const a=Math.random()*Math.PI*2,o=2+Math.random()*8;return{x:n*e,y:r*t,vx:Math.cos(a)*o,vy:Math.sin(a)*o,size:3+Math.random()*3,color:s,alpha:1,rotation:0,rotationSpeed:0,life:0,maxLife:60+Math.random()*40,type:"circle"}},Qr=(e,t,n,r)=>{const s=-Math.PI/2+(Math.random()-.5)*Math.PI*.8,a=6+Math.random()*8;return{x:n*e,y:r*t,vx:Math.cos(s)*a,vy:Math.sin(s)*a-8,size:18+Math.random()*10,color:String(Math.floor(Math.random()*3)),alpha:1,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*.3,life:0,maxLife:50+Math.random()*20,type:"coin"}},Xr=(e,t,n,r,s)=>{const a=Math.random()*Math.PI*2,o=2+Math.random()*5;return{x:n*e,y:r*t,vx:Math.cos(a)*o,vy:Math.sin(a)*o-2,size:2+Math.random()*3,color:s[Math.floor(Math.random()*s.length)],alpha:1,rotation:0,rotationSpeed:0,life:0,maxLife:40+Math.random()*30,type:"circle"}},vt=(e,t,n)=>{const r=["#FFD700","#FFA500","#FFEC8B"],s=t/2;e.beginPath(),e.arc(0,0,s,0,Math.PI*2),e.fillStyle=r[n%r.length],e.fill(),e.strokeStyle="#B8860B",e.lineWidth=1.5,e.stroke()},Kr=(e,t,n=vt)=>{switch(e.save(),e.globalAlpha=t.alpha,e.fillStyle=t.color,e.translate(t.x,t.y),e.rotate(t.rotation),t.type){case"rect":e.fillRect(-t.size/2,-t.size/4,t.size,t.size/2);break;case"circle":e.beginPath(),e.arc(0,0,t.size/2,0,Math.PI*2),e.fill();break;case"star":Jr(e,0,0,5,t.size/2,t.size/4),e.fill();break;case"coin":n(e,t.size,parseInt(t.color)||0);break}e.restore()},Jr=(e,t,n,r,s,a)=>{let o=Math.PI/2*3;const l=Math.PI/r;e.beginPath(),e.moveTo(t,n-s);for(let u=0;u<r;u++)e.lineTo(t+Math.cos(o)*s,n+Math.sin(o)*s),o+=l,e.lineTo(t+Math.cos(o)*a,n+Math.sin(o)*a),o+=l;e.lineTo(t,n-s),e.closePath()},Zr=(e,t)=>{e.save(),e.globalAlpha=t.alpha,e.strokeStyle=t.color,e.lineWidth=t.lineWidth,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.stroke(),e.restore()},es=({effect:e,primaryColor:t="#FFD700",secondaryColor:n="#FF6B6B",origin:r={x:.5,y:.5},onComplete:s,intensity:a=1,drawCoin:o=vt,lostSparkColors:l})=>{const u=i.useRef(null),d=i.useRef([]),f=i.useRef([]),h=i.useRef(null),p=i.useRef(null),v=i.useCallback(P=>{const b=u.current;if(!b)return;const x=b.clientWidth,S=b.clientHeight,g=Math.min(x,S);switch(P){case"confetti":for(let C=0;C<Math.floor(40*a);C++)d.current.push(Yr(x,S,r.x,r.y));break;case"coins":const T=5+Math.floor(Math.random()*6);for(let C=0;C<T;C++)d.current.push(Qr(x,S,r.x,r.y));break;case"sparks":for(let C=0;C<Math.floor(15*a);C++)d.current.push(Vr(x,S,r.x,r.y));break;case"lostSparks":{const C=5+Math.floor(Math.random()*6),I=l||pt;for(let m=0;m<C;m++)d.current.push(Xr(x,S,r.x,r.y,I));break}case"pulse":f.current.push({x:r.x*x,y:r.y*S,radius:10,maxRadius:g*.5,alpha:.8,color:t,lineWidth:4}),setTimeout(()=>{f.current.push({x:r.x*x,y:r.y*S,radius:10,maxRadius:g*.4,alpha:.6,color:n,lineWidth:2})},100);break;case"fireworks":const A=[t,n,"#FFD700","#4ECDC4"],y=Math.floor(3*a);for(let C=0;C<y;C++){const I=.2+Math.random()*.6,m=.2+Math.random()*.4,w=A[C%A.length];setTimeout(()=>{for(let E=0;E<40;E++)d.current.push(Ur(x,S,I,m,w));f.current.push({x:I*x,y:m*S,radius:5,maxRadius:100,alpha:.5,color:w,lineWidth:2})},C*300)}break}},[r,t,n,a,l]),M=i.useCallback(()=>{const P=u.current,b=P==null?void 0:P.getContext("2d");if(!P||!b)return;const x=P.clientWidth,S=P.clientHeight;b.clearRect(0,0,x,S),d.current=d.current.filter(g=>{g.life++,g.x+=g.vx,g.y+=g.vy,g.vy+=g.type==="coin"?.25:.6,g.vx*=.99,g.rotation+=g.rotationSpeed;const T=g.life/g.maxLife;return g.alpha=Math.max(0,1-T*T),g.alpha>.01?(Kr(b,g,o),!0):!1}),f.current=f.current.filter(g=>(g.radius+=8,g.alpha*=.96,g.lineWidth*=.98,g.alpha>.01&&g.radius<g.maxRadius?(Zr(b,g),!0):!1)),d.current.length>0||f.current.length>0?h.current=requestAnimationFrame(M):(h.current=null,s==null||s())},[s,o]);return i.useEffect(()=>{e&&e!==p.current&&(p.current=e,v(e),h.current||(h.current=requestAnimationFrame(M))),e||(p.current=null)},[e,v,M]),i.useEffect(()=>{const P=u.current;if(!P)return;const b=()=>{const x=P.parentElement;if(!x)return;const S=x.getBoundingClientRect(),g=window.devicePixelRatio||1;P.style.width=`${S.width}px`,P.style.height=`${S.height}px`,P.width=Math.round(S.width*g),P.height=Math.round(S.height*g);const T=P.getContext("2d");T==null||T.setTransform(g,0,0,g,0,0)};return b(),window.addEventListener("resize",b),()=>{window.removeEventListener("resize",b),h.current&&cancelAnimationFrame(h.current)}},[]),c.jsx("canvas",{ref:u,id:"effects-canvas",className:"absolute inset-0 pointer-events-none z-50",style:{width:"100%",height:"100%"}})},ts=240,Dt=140,We=-16,qe=7,ns=3,ue=9,Bt=28,rs=24,ss=20,zt=3.2,as=34;function Ot(e,t,n){var s,a;if(t===0&&n===0)return!0;try{const o=(s=document.elementsFromPoint)==null?void 0:s.call(document,t,n);if(o&&o.length>0)return o.some(u=>e.contains(u));const l=(a=document.elementFromPoint)==null?void 0:a.call(document,t,n);if(l)return e.contains(l)}catch{}const r=e.getBoundingClientRect();return t>=r.left&&t<=r.right&&n>=r.top&&n<=r.bottom}const me=(e,t,n)=>Math.min(n,Math.max(t,e)),He=(e,t,n)=>e+(t-e)*n;function os({ref:e,selected:t,onSelect:n}){const[r,s]=i.useState("Appear"),[a,o]=i.useState(!1),l=i.useRef(t),u=i.useRef(t),d=i.useRef("Appear"),f=i.useRef(!1),h=i.useRef(null),p=i.useRef(null),v=i.useRef(!1),M=i.useRef(null),P=i.useRef(null),b=i.useRef({isActive:t,y:0,v:0,targetY:0,wantedY:t?We:0,bobPhase:0,bobAmp:0,bobAmpTarget:t?qe:0,tiltX:0,tiltY:0,tiltXTarget:0,tiltYTarget:0,lastPointer:null,lastT:0,rafId:null}),x=()=>{M.current&&window.clearTimeout(M.current),P.current&&window.clearTimeout(P.current),M.current=null,P.current=null};i.useEffect(()=>{d.current=r},[r]),i.useEffect(()=>{f.current=a},[a]);const S=i.useCallback(A=>{const y=b.current;A.style.setProperty("--campaign-mainY",`${y.y.toFixed(3)}px`),A.style.setProperty("--campaign-bobY",`${(-Math.sin(y.bobPhase)*y.bobAmp).toFixed(3)}px`),A.style.setProperty("--campaign-rx",`${y.tiltX.toFixed(3)}deg`),A.style.setProperty("--campaign-ry",`${y.tiltY.toFixed(3)}deg`);const C=me(y.tiltX/ue,0,1),I=me(-y.tiltY/ue,0,1),m=Math.pow(C*I,.85);A.style.setProperty("--campaign-glare",`${m.toFixed(3)}`),A.style.setProperty("--campaign-glareX",`${(y.tiltY/ue*Bt).toFixed(3)}px`),A.style.setProperty("--campaign-glareY",`${(-y.tiltX/ue*Bt).toFixed(3)}px`);const w=me(y.tiltX/ue,-1,1),E=me(y.tiltY/ue,-1,1),F=Math.min(1,Math.hypot(w,E)),L=E*zt,j=-w*zt,G=rs+F*ss,te=me(-E,0,1),X=me(w,0,1),Z=Math.min(1,(te+X)/1.2),R=2+Z*10,$=8+Z*6,W=.45+Z*.25;A.style.setProperty("--campaign-icon-shift-x",`${L.toFixed(3)}px`),A.style.setProperty("--campaign-icon-shift-y",`${j.toFixed(3)}px`),A.style.setProperty("--campaign-icon-z",`${G.toFixed(3)}px`),A.style.setProperty("--campaign-icon-shadow-x",`${R.toFixed(3)}px`),A.style.setProperty("--campaign-icon-shadow-y",`${R.toFixed(3)}px`),A.style.setProperty("--campaign-icon-shadow-blur",`${$.toFixed(3)}px`),A.style.setProperty("--campaign-icon-shadow-opacity",`${W.toFixed(3)}`)},[]),g=i.useCallback(()=>{const A=e.current;if(!A)return;const y=b.current;if(y.rafId!=null)return;y.lastT=performance.now();const C=I=>{const m=me((I-y.lastT)/1e3,0,.02);y.lastT=I;const E=1-Math.exp(-m/.09);y.targetY=He(y.targetY,y.wantedY,E);const F=-190*(y.y-y.targetY)-as*y.v;y.v+=F*m,y.y+=y.v*m;const j=1-Math.exp(-m/.32);y.bobAmp=He(y.bobAmp,y.bobAmpTarget,j);const G=Math.PI*2/ns;if(y.bobPhase+=G*m,(y.isActive||f.current)&&y.lastPointer!=null&&y.lastPointer){const R=A.getBoundingClientRect(),$=y.lastPointer.x-R.left,W=y.lastPointer.y-R.top,Q=$/R.width*2-1,J=W/R.height*2-1,Y=Math.sign(Q)*Math.pow(Math.abs(Q),.85),N=Math.sign(J)*Math.pow(Math.abs(J),.85);y.tiltXTarget=me(-N*ue,-ue,ue),y.tiltYTarget=me(Y*ue,-ue,ue)}else y.tiltXTarget=0,y.tiltYTarget=0;const Z=1-Math.exp(-m/.08);if(y.tiltX=He(y.tiltX,y.tiltXTarget,Z),y.tiltY=He(y.tiltY,y.tiltYTarget,Z),S(A),!y.isActive&&d.current==="Deactivate"){const R=Math.abs(y.y)<.06&&Math.abs(y.v)<.25&&y.bobAmp<.08,$=Math.abs(y.tiltX)<.05&&Math.abs(y.tiltY)<.05;if(R&&$){const W=f.current&&!y.isActive?"Hover":"Idle";d.current=W,s(W)}}if(!y.isActive&&!f.current){const R=Math.abs(y.y)<.05&&Math.abs(y.v)<.25&&y.bobAmp<.05,$=Math.abs(y.tiltX)<.05&&Math.abs(y.tiltY)<.05;if(R&&$){y.y=0,y.v=0,y.targetY=0,y.wantedY=0,y.bobAmp=0,y.bobAmpTarget=0,y.tiltX=0,y.tiltY=0,y.tiltXTarget=0,y.tiltYTarget=0,S(A),y.rafId=null;return}}y.rafId=window.requestAnimationFrame(C)};y.rafId=window.requestAnimationFrame(C)},[S,e]);i.useEffect(()=>(x(),P.current=window.setTimeout(()=>{s(l.current?"Activate":"Idle")},ts),()=>x()),[]),i.useEffect(()=>{const A=b.current;return()=>{x(),A.rafId!=null&&(window.cancelAnimationFrame(A.rafId),A.rafId=null)}},[]),i.useEffect(()=>{const A=b.current;r==="Activate"&&(A.isActive=!0,A.wantedY=We,A.bobAmpTarget=qe,g()),r==="Deactivate"&&(A.isActive=!1,A.wantedY=0,A.bobAmpTarget=0,g())},[g,r]),i.useEffect(()=>{if(r==="Deactivate")return M.current&&window.clearTimeout(M.current),M.current=window.setTimeout(()=>{s(A=>A!=="Deactivate"?A:f.current?"Hover":"Idle")},Math.max(120,Math.round(Dt*1.25))),()=>{M.current&&window.clearTimeout(M.current),M.current=null}},[r]),i.useEffect(()=>{if(u.current===t)return;u.current=t;const y=b.current;if(y.isActive=t,t){s("Activate"),y.wantedY=We,y.bobAmpTarget=qe,g();return}s("Deactivate"),x(),y.wantedY=0,y.bobAmpTarget=0,g()},[t,g]);const T=i.useMemo(()=>{const A=()=>{M.current&&window.clearTimeout(M.current),M.current=window.setTimeout(()=>{s(()=>a?"Hover":"Idle")},Dt)};return{onPointerEnter:L=>{o(!0),b.current.lastPointer={x:L.clientX,y:L.clientY},g(),s(j=>!t&&j==="Idle"?"Hover":j)},onPointerLeave:()=>{o(!1),b.current.lastPointer=null,g(),s(L=>!t&&L==="Hover"?"Idle":L)},onPointerDown:L=>{if(!t&&!(r==="Deactivate"||r==="Disappear")&&!(L.button!==0&&L.pointerType!=="touch")){h.current=L.pointerId,p.current=L.pointerType,v.current=!1,o(!0),s("Press");try{L.currentTarget.setPointerCapture(L.pointerId)}catch{}}},onPointerMove:L=>{b.current.lastPointer={x:L.clientX,y:L.clientY},g(),!t&&r==="Press"&&o(Ot(L.currentTarget,L.clientX,L.clientY))},onPointerUp:L=>{if(t||h.current!==L.pointerId)return;h.current=null;try{L.currentTarget.releasePointerCapture(L.pointerId)}catch{}const j=Ot(L.currentTarget,L.clientX,L.clientY);if(o(j),v.current=j,j){s("Activate"),b.current.isActive=!0,b.current.wantedY=We,b.current.bobAmpTarget=qe,g(),n();return}s("Ease"),A()},onPointerCancel:L=>{t||h.current===L.pointerId&&(h.current=null,o(!1),v.current=!0,s("Ease"),A())},onLostPointerCapture:()=>{t||h.current!=null&&(h.current=null,o(!1),v.current=!0,s("Ease"),A())}}},[a,n,t,g,r]);return i.useEffect(()=>{const A=e.current;A&&S(A)},[S,e]),{state:r,eventHandlers:T,suppressNextClickRef:v}}const is=e=>{const t=`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>${e}</text></svg>`;return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`},ls=(e,t)=>{var r;const n=e==null?void 0:e.currentTarget;n&&((r=n.dataset)==null?void 0:r.emojiFallbackApplied)!=="true"&&(n.dataset.emojiFallbackApplied="true",n.src=is(t))};function _t({gameId:e,campaign:t,selected:n,onSelect:r,isLightTheme:s,style:a}){const o=t.icon??(({className:p,size:v})=>c.jsx("img",{src:Ke(e,`campaigns/${t.id}.webp`),alt:t.name,loading:"lazy",draggable:!1,className:`${Jt} ${p??Zt(v)}`,onError:M=>ls(M,"ðŸŽ¯")})),l=i.useRef(null),u=os({ref:l,selected:n,onSelect:r}),d=t.theme.campaignCardGlowColor??t.theme.glowColor,f=t.theme.campaignCardGlowSecondary??t.theme.glowSecondary,h=t.theme.campaignCardGlow??t.theme.glow;return c.jsxs("button",{ref:l,onClick:p=>{if(u.suppressNextClickRef.current){u.suppressNextClickRef.current=!1,p.preventDefault(),p.stopPropagation();return}n||r()},...u.eventHandlers,"data-campaign-card":"true","data-selected":n?"true":"false","data-card-state":u.state,className:`campaign-card relative flex-none overflow-hidden border-4 w-[170px] h-[215px] ${s?"bg-gradient-to-b from-white/60 via-white/40 to-white/20":"bg-gradient-to-b from-stone-950/80 via-stone-950/60 to-black/80"}`,style:{"--campaign-glow":d,"--campaign-glow-secondary":f,borderStyle:"ridge",borderColor:n?d:"#44403c",boxShadow:n?`0 0 26px ${h}, 0 16px 60px rgba(0,0,0,0.55), inset 0 0 14px ${h}`:"0 14px 56px rgba(0,0,0,0.55)",...a??{}},onMouseEnter:p=>{n||(p.currentTarget.style.borderColor=d)},onMouseLeave:p=>{n||(p.currentTarget.style.borderColor="#44403c")},children:[c.jsx("div",{"aria-hidden":"true",className:"campaign-card-glass pointer-events-none absolute inset-0 bg-gradient-to-b from-white/10 via-transparent to-black/35"}),c.jsx("div",{"aria-hidden":"true",className:"campaign-card-glass pointer-events-none absolute inset-0 bg-gradient-to-br from-white/10 via-transparent to-transparent"}),c.jsx("div",{"aria-hidden":"true",className:"campaign-card-glare pointer-events-none absolute"}),c.jsx("div",{"aria-hidden":"true",className:`campaign-card-frame pointer-events-none absolute inset-2 border ${s?"border-black/10":"border-white/10"}`}),c.jsxs("div",{className:"relative w-full h-full px-3 pt-7 pb-3 flex flex-col items-center",children:[c.jsxs("div",{className:"relative mt-0 w-[98px] h-[98px] flex items-center justify-center overflow-visible",children:[c.jsx("div",{"aria-hidden":"true",className:"campaign-icon-glow"}),c.jsx("div",{"aria-hidden":"true",className:"campaign-icon-rays-wrap",children:c.jsx("div",{"aria-hidden":"true",className:"campaign-icon-rays"})}),c.jsx("div",{className:"campaign-icon-parallax",children:c.jsx(o,{className:"campaign-icon-img relative z-10 w-full h-full max-w-full max-h-full object-contain text-5xl leading-none"})})]}),c.jsx("span",{"data-campaign-name":"true",className:"relative mt-5 w-full max-w-full px-0.5 text-sm font-bold text-center leading-tight whitespace-nowrap overflow-hidden",style:{color:n?d:f,transform:"scale(var(--campaign-name-scale, 1))",transformOrigin:"center top"},children:t.name}),c.jsx("span",{"data-campaign-label":"true",className:`relative mt-2 w-full max-w-full px-0.5 text-xs text-center leading-tight whitespace-nowrap overflow-hidden ${s?"text-stone-600":"text-stone-400"}`,style:{transform:"scale(var(--campaign-label-scale, 1))",transformOrigin:"center top"},children:t.label})]})]})}const Me=(e,t,n)=>Math.min(n,Math.max(t,e));function cs({config:e,selectedCampaign:t,onSelectCampaign:n,onStartGame:r,onActionButtonPress:s,theme:a}){const o=!!a.isLight,l=e.campaigns,u=i.useMemo(()=>l.slice(0,3),[l]),d=i.useMemo(()=>l.slice(3),[l]),f=i.useRef(null),h=i.useRef(null),p=i.useRef(null),v=i.useRef(null),[M,P]=i.useState(1),[b,x]=i.useState(0),[S,g]=i.useState(null),[T,A]=i.useState(1),[y,C]=i.useState(1),I=M<.999;i.useLayoutEffect(()=>{const R=f.current,$=h.current;if(!R||!$)return;let W=null;const Q=()=>{W!=null&&window.cancelAnimationFrame(W),W=window.requestAnimationFrame(()=>{W=null;const Y=R.clientWidth,N=$.scrollWidth;if(Y<=0||N<=0)return;const D=Me((Y-1)/N,.48,1);P(_=>Math.abs(_-D)<.002?_:D),x(Y)})};Q();const J=new ResizeObserver(()=>Q());return J.observe(R),()=>{J.disconnect(),W!=null&&window.cancelAnimationFrame(W)}},[u.length]),i.useLayoutEffect(()=>{if(!I){g(null);return}const R=f.current;if(!R)return;let $=null;const W=()=>{$!=null&&window.cancelAnimationFrame($),$=window.requestAnimationFrame(()=>{$=null;const J=R.offsetHeight;if(!J)return;const Y=Math.round(J*M);g(N=>N===Y?N:Y)})};W();const Q=new ResizeObserver(()=>W());return Q.observe(R),()=>{Q.disconnect(),$!=null&&window.cancelAnimationFrame($)}},[M,I]),i.useLayoutEffect(()=>{const R=v.current;if(!R)return;let $=null,W=!1;const Q=()=>{$!=null&&window.cancelAnimationFrame($),$=window.requestAnimationFrame(()=>{$=null,R.style.fontSize="";const N=window.getComputedStyle(R),D=Number.parseFloat(N.fontSize);if(!Number.isFinite(D)||D<=0)return;const _=()=>{const ne=Number.parseFloat(window.getComputedStyle(R).lineHeight);return!Number.isFinite(ne)||ne<=0?0:Math.ceil(R.scrollHeight/ne)},k=3;if(_()<=k)return;const z=Math.max(10,D*.7);let V=z,U=D,K=z;for(let ne=0;ne<8;ne+=1){const se=(V+U)/2;R.style.fontSize=`${se.toFixed(2)}px`,_()<=k?(K=se,V=se):U=se}R.style.fontSize=`${K.toFixed(2)}px`})};Q();const J=new ResizeObserver(()=>Q());J.observe(R);const Y=document==null?void 0:document.fonts;return Y!=null&&Y.ready&&Y.ready.then(()=>{W||Q()}),()=>{W=!0,J.disconnect(),$!=null&&window.cancelAnimationFrame($)}},[e.strings.introText]),i.useLayoutEffect(()=>{const R=p.current;if(!R)return;let $=null,W=!1;const Q=D=>{const _=Array.from(R.querySelectorAll(D));if(_.length===0)return 1;let k=1;for(const q of _){const z=q.clientWidth,V=q.scrollWidth;z<=0||V<=0||V>z&&(k=Math.min(k,z/V))}return Me(k,.68,1)},J=()=>{$!=null&&window.cancelAnimationFrame($),$=window.requestAnimationFrame(()=>{if($=null,W)return;const D=Q("[data-campaign-name]"),_=Q("[data-campaign-label]");A(k=>Math.abs(k-D)<.003?k:D),C(k=>Math.abs(k-_)<.003?k:_)})};J();const Y=new ResizeObserver(()=>J());Y.observe(R);const N=document==null?void 0:document.fonts;return N!=null&&N.ready&&N.ready.then(()=>{W||J()}),()=>{W=!0,Y.disconnect(),$!=null&&window.cancelAnimationFrame($)}},[l]);const m=(t==null?void 0:t.id)??null,w=i.useMemo(()=>m?u.findIndex(R=>R.id===m):-1,[u,m]),E=Me((1-M)/.52,0,1),F=I&&w>=0,L=i.useMemo(()=>{if(!I||M<=0)return{scale:1,z:0};const $=b>0?Me(b*.96/170,1.12,2.4):2.4,W=1.09+E*.11,Q=Math.min(W,$),J=Me(Q/M,1.04,1.6),Y=Me(35+(Q-1)*90,35,140);return{scale:J,z:Y}},[b,M,I,E]),j=I?L.scale:1,X=14+(I?14:10),Z={paddingTop:`${X}px`,paddingBottom:`${X}px`,"--campaign-name-scale":T.toFixed(3),"--campaign-label-scale":y.toFixed(3)};return I&&d.length===0&&S&&(Z.height=`${Math.round(S*j)}px`),c.jsxs(be,{className:"p-1 animate-slide-in stagger-2",children:[c.jsx(Ce,{children:e.strings.selectPath}),c.jsxs("div",{className:"text-center py-5 sm:py-7 px-4",children:[c.jsx("p",{ref:v,className:`${a.textSecondary} text-sm sm:text-base mb-4 sm:mb-6 max-w-md mx-auto leading-relaxed whitespace-pre-line`,children:e.strings.introText}),c.jsx("div",{ref:p,className:"mb-4 sm:mb-6",style:Z,children:c.jsxs("div",{className:`flex flex-col items-center ${I?"gap-3 sm:gap-5":"gap-4 sm:gap-6"}`,children:[c.jsx("div",{ref:f,className:"w-full flex justify-center overflow-visible",children:c.jsx("div",{ref:h,className:"inline-flex justify-center gap-3 sm:gap-4 md:gap-6","data-campaign-row-scaled":I?"true":"false",style:{transform:`scale(${M.toFixed(4)})`,transformOrigin:"top center"},children:u.map((R,$)=>{const W=m===R.id;let Q;return F&&W&&(Q={"--campaign-shiftX":"0px","--campaign-z":`${L.z.toFixed(1)}px`,"--campaign-focusScale":`${L.scale.toFixed(3)}`}),c.jsx(_t,{gameId:e.id,campaign:R,selected:W,isLightTheme:o,onSelect:()=>n(R),style:Q},R.id)})})}),d.length>0&&c.jsx("div",{className:"w-full flex justify-center",children:c.jsx("div",{className:"flex justify-center gap-3 sm:gap-4 md:gap-6 flex-wrap",children:d.map(R=>c.jsx(_t,{gameId:e.id,campaign:R,selected:m===R.id,isLightTheme:o,onSelect:()=>n(R)},R.id))})})]})}),c.jsx(ln,{theme:a,onClick:r,onPointerDown:R=>t&&s(R),disabled:!t,className:t?`bg-gradient-to-b ${a.bgButton} text-white ${a.borderLight}`:"bg-gradient-to-b from-stone-700 via-stone-800 to-stone-900 text-stone-500 border-stone-600 cursor-not-allowed",children:e.strings.startButton})]})]})}function us({config:e,selectedCampaign:t,onSelectCampaign:n,onStartGame:r,onActionButtonPress:s,theme:a}){return c.jsx(cs,{config:e,selectedCampaign:t,onSelectCampaign:n,onStartGame:r,onActionButtonPress:s,theme:a})}function lt({label:e,value:t,min:n,max:r,step:s=1,disabled:a=!1,formatValue:o,onChange:l}){const u=i.useId(),d=o?o(t):String(Math.round(t));return c.jsxs("div",{className:"flex flex-col items-center gap-1",children:[c.jsx("label",{htmlFor:u,className:`text-[10px] tracking-wide uppercase select-none ${a?"text-white/25":"text-white/70"}`,children:e}),c.jsx("div",{className:"relative h-32 w-8 flex items-center justify-center",children:c.jsx("input",{id:u,type:"range",min:n,max:r,step:s,value:t,disabled:a,onChange:f=>l(Number(f.target.value)),className:"h-32 w-8 appearance-none bg-transparent cursor-pointer",style:{writingMode:"bt-lr",WebkitAppearance:"slider-vertical",accentColor:a?"rgba(255,255,255,0.25)":"rgba(255,255,255,0.85)"}})}),c.jsx("div",{className:`text-[10px] tabular-nums ${a?"text-white/25":"text-white/70"}`,children:d})]})}const de={translateY:-45,scale:1.15,panelsOverlap:-120};function ct(e,t,n){return Math.max(t,Math.min(n,e))}function ut(e,t){const n=Number(e);return Number.isFinite(n)?n:t}function ds({storageKey:e,disabled:t=!1,onChange:n}){const r=i.useMemo(()=>`${e}:enabled`,[e]),s=i.useMemo(()=>`${e}:values`,[e]),[a,o]=i.useState(()=>{try{return localStorage.getItem(r)==="1"}catch{return!1}}),[l,u]=i.useState(()=>{try{const p=localStorage.getItem(s);if(!p)return de;const v=JSON.parse(p),M=typeof v.translateY=="number"?v.translateY:de.translateY,P=typeof v.scale=="number"?v.scale:de.scale,b=typeof v.panelsOverlap=="number"?v.panelsOverlap:de.panelsOverlap;return{translateY:ct(ut(String(M),de.translateY),-120,80),scale:ct(ut(String(P),de.scale),.8,1.3),panelsOverlap:ct(ut(String(b),de.panelsOverlap),-220,220)}}catch{return de}});i.useEffect(()=>{t||n(a?l:de)},[t,a,n,l]),i.useEffect(()=>{try{localStorage.setItem(r,a?"1":"0")}catch{}},[r,a]),i.useEffect(()=>{try{localStorage.setItem(s,JSON.stringify(l))}catch{}},[s,l]);const d=i.useCallback(p=>{u(v=>({...v,...p}))},[]),f=()=>{t||o(p=>!p)},h=t;return c.jsxs("div",{className:"pointer-events-auto flex flex-col items-end gap-2",children:[c.jsx("button",{type:"button",onClick:f,className:`text-[10px] tracking-wide uppercase px-2 py-1 rounded border ${h?"opacity-40 cursor-not-allowed":"hover:bg-white/10"} border-white/20 bg-black/35 text-white/80 backdrop-blur-[2px]`,title:"Portal header tuner",children:a?"Tuner: on":"Tuner: off"}),a&&c.jsxs("div",{className:"flex items-start gap-2 pr-0.5",children:[c.jsx(lt,{label:"Y",min:-120,max:80,step:1,value:l.translateY,disabled:h,onChange:p=>d({translateY:p})}),c.jsx(lt,{label:"S",min:.8,max:1.3,step:.01,value:l.scale,formatValue:p=>`${Math.round(p*100)}%`,disabled:h,onChange:p=>d({scale:p})}),c.jsx(lt,{label:"H",min:-220,max:220,step:2,value:l.panelsOverlap,disabled:h,onChange:p=>d({panelsOverlap:p})})]})]})}const Fe={};async function fs(e){const t=e;if(t in Fe)return Fe[t];try{const n=await fetch(`${e}/manifest.json`);if(!n.ok)return Fe[t]=null,null;const r=await n.json();return Fe[t]=r,r}catch{return Fe[t]=null,null}}const mt=e=>e&&typeof e=="object"?e:null;function ps(e,t){let n=e;for(const a of t){const o=mt(n);if(!o)return[];n=o[a]}const r=mt(n),s=r==null?void 0:r.images;return Array.isArray(s)?s:[]}function Wt(e,t){for(const{node:n,basePath:r}of e)for(const s of t){const a=ps(n,s);if(a.length>0)return{images:a,basePath:r,subfolder:s.join("/")}}return null}function qt(e,t){if(e==="start")return[["start"],[]];if(e==="play"){const n=[];return t&&n.push(["play",t]),n.push(["play"]),n.push([]),n}return[["end",e],[e],[]]}function ms(e,{gameId:t,campaignId:n,screen:r,difficulty:s}){const a=`${t}::${n??""}::${r}::${s??""}`,o=(e==null?void 0:e.enabled)??!0,l=(e==null?void 0:e.transitionDuration)??1500,u=(e==null?void 0:e.displayDuration)??15e3,d=(e==null?void 0:e.opacity)??1,[f,h]=i.useState([]),[p,v]=i.useState(""),[M,P]=i.useState(""),[b,x]=i.useState(!0),[S,g]=i.useState(a),T=i.useMemo(()=>bn(t),[t]);i.useEffect(()=>{if(!o){h([]),v(""),P(""),x(!1),g(a);return}let y=!1;async function C(){if(y)return;const I=a,m=await fs(T),w=[];if(n&&(m!=null&&m.campaigns)){const F=m.campaigns,L=mt(F),j=L==null?void 0:L[n];j&&w.push({node:j,basePath:`${T}/campaigns/${n}`}),w.push({node:F,basePath:`${T}/campaigns`})}m&&w.push({node:m,basePath:T});const E=Wt(w,qt(r,s));if(E){y||(h(E.images),v(E.basePath),P(E.subfolder),x(!1),g(I));return}if(r!=="start"){const F=Wt(w,qt("start"));if(F){y||(h(F.images),v(F.basePath),P(F.subfolder),x(!1),g(I));return}}y||(h([]),v(""),P(""),x(!1),g(I))}return x(!0),C(),()=>{y=!0}},[n,s,o,T,a,r]);const A=S!==a;return{enabled:o,transitionDuration:l,displayDuration:u,opacity:d,isLoading:A?!0:b,images:A?[]:f,basePath:A?"":p,subfolder:A?"":M}}function hs(){const[e,t]=i.useState(!1);return i.useEffect(()=>{},[]),e}const gs=160,ys=Math.ceil(gs*960/310),xs=720,ws=240;function bs({translateY:e,scale:t,active:n,containerRef:r,canvasRef:s,zIndex:a=10}){const o=`min(1120px, max(${ys}px, calc(100vw + clamp(0px, ${xs}px - 100vw, ${ws}px))))`;return c.jsx("div",{className:"absolute inset-x-0 top-0 flex justify-center overflow-visible pointer-events-none",style:{zIndex:a,opacity:n?1:0,transition:"opacity 260ms ease",transform:`translateY(${e}px)`},children:c.jsx("div",{ref:r,style:{position:"relative",width:o,aspectRatio:"960 / 310",transform:`scale(${t})`,transformOrigin:"top center",background:"transparent",overflow:"visible"},children:c.jsx("canvas",{ref:s,className:"absolute inset-0 w-full h-full",style:{pointerEvents:"none"}})})})}function vs(e){const[t,n]=i.useState(0);return i.useLayoutEffect(()=>{var l,u;const r=e.current;if(!r)return;let s=0;const a=()=>{s=0;const d=r.getBoundingClientRect();n(d.top)},o=()=>{s||(s=window.requestAnimationFrame(a))};return o(),window.addEventListener("resize",o),window.addEventListener("scroll",o,{passive:!0}),(l=window.visualViewport)==null||l.addEventListener("resize",o),(u=window.visualViewport)==null||u.addEventListener("scroll",o),()=>{var d,f;s&&window.cancelAnimationFrame(s),window.removeEventListener("resize",o),window.removeEventListener("scroll",o),(d=window.visualViewport)==null||d.removeEventListener("resize",o),(f=window.visualViewport)==null||f.removeEventListener("scroll",o)}},[e]),t}function Ss(){var e,t;try{return((t=(e=window.matchMedia)==null?void 0:e.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:t.matches)??!1}catch{return!1}}const Ms={targetAspect:960/310,portalMargin:.05,superN:2.7,portalDetail:.9,revealDetail:1.1,portalTSpeed:.55,revealTSpeed:.8,layersCount:3,layerScaleInner:.9,layerScaleOuter:1.1,layerAlphaInner:1,layerAlphaOuter:.1,gapOpen:.12,gapClose:.1,openDelayGamma:1.8,closeDelayGamma:.65,alphaOpenInnerGamma:1.25,alphaOpenOuterGamma:.55,alphaCloseInnerGamma:1.05,alphaCloseOuterGamma:2.2,enableBlur:!1,featherBasePx:2.5,blurStepPx:3,featherMult:2.3,coreMult:1,layerPhaseOffset:.75,layerPhaseJitter:.35};function pe(e){return Math.max(0,Math.min(1,e))}function Xe(e,t,n){return e+(t-e)*n}function Ht(e,t){return Math.pow(Math.abs(e),t)}function Gt(e){return Math.abs(e)<1e-12?0:e<0?-1:1}function he(){return typeof performance<"u"?performance.now():Date.now()}function Ue(e){const t=Math.sin(e*127.1+311.7)*43758.5453123;return t-Math.floor(t)}function Yt(e,t){return Math.pow(pe(e),Math.max(.001,t))}function As(e,t){const n=1-pe(e);return 1-Math.pow(n,Math.max(.001,t))}function Vt(e){const t=Math.max(1,Math.round(e.layersCount)),n=[];for(let r=0;r<t;r+=1){const s=t===1?0:r/(t-1);n.push({scale:Xe(e.layerScaleInner,e.layerScaleOuter,s),alpha:Xe(e.layerAlphaInner,e.layerAlphaOuter,s)})}return n}function Ps(e,t,n){const r=n*.5*(1-e.portalMargin*2),s=t*.5*(1-e.portalMargin*2),a=r,o=Math.min(s,a*e.targetAspect),l=Math.min(a,o/e.targetAspect);return{a:o,b:l}}function Is(e,t,n,r){const s=Math.cos(e),a=Math.sin(e),o=2/r;return{x:t*Gt(s)*Ht(s,o),y:n*Gt(a)*Ht(a,o)}}function Ts(e,t,n,r,s){const a=r==="reveal"?.85:1,o=(Ue(s+1.3)-.5)*2,l=(Ue(s+2.7)-.5)*2,u=(Ue(s+5.1)-.5)*2,d=o*1.8,f=l*1.6,h=1+.1*u,p=1+.07*o,v=.11*Math.sin((e+d)*1+(t+f)*.33*h)+.08*Math.sin((e+d)*2-(t+f)*.21*p)+.06*Math.sin((e-d*.6)*4+(t-f*.4)*.18),M=.082*Math.sin(2*(e+d)+(t+f)*1.05*h)+.061*Math.sin(3*(e-d*.6)-(t+f)*.78*p)+.044*Math.sin(5*(e+d*.4)+(t-f)*.46)+.03*Math.sin(9*(e-d)-(t-f)*.31)+.022*Math.sin(13*(e+d*.2)+(t+f)*.27);return 1+a*n*(M+v)}function je(e,t,n,r,s,a,o){const{steps:l,detail:u,seed:d}=o,f=Math.min(n,r),h=pe(f/220),p=u*(.12+.88*h);e.beginPath();for(let v=0;v<=l;v+=1){const M=v/l*Math.PI*2,P=Is(M,n,r,t.superN),b=Ts(M,s,p,a,d),x=P.x*b,S=P.y*b;v===0?e.moveTo(x,S):e.lineTo(x,S)}e.closePath()}function Es(e,t,n,r,s){const a=Math.max(1,r-1);if(s==="close"){const h=a*e.gapClose,p=Math.max(.001,1-h),v=1-pe(t),M=n/a,P=Math.pow(M,e.closeDelayGamma)*h;return 1-pe((v-P)/p)}const o=a*e.gapOpen,l=Math.max(.001,1-o),u=pe(t),d=(r-1-n)/a,f=Math.pow(d,e.openDelayGamma)*o;return pe((u-f)/l)}function Ls(e,t,n,r,s){const a=pe(t),o=r<=1?0:n/(r-1);if(s==="open"){const u=Xe(e.alphaOpenInnerGamma,e.alphaOpenOuterGamma,o);return Math.pow(a,u)}const l=Xe(e.alphaCloseInnerGamma,e.alphaCloseOuterGamma,o);return Math.pow(a,l)}function Ut(e,t,n,r,s,a,o,l,u,d,f){const h=d==="reveal"?t.revealDetail:t.portalDetail,p=d==="reveal"?220:250;e.save(),e.translate(r,s),e.fillStyle="rgba(255,255,255,1)";for(let v=0;v<n.length;v+=1){const M=n[v],P=Es(t,l,v,n.length,f),b=Ls(t,P,v,n.length,f),x=6,S=6,g=Math.max(x,a*M.scale*P),T=Math.max(S,o*M.scale*P),A=(d==="reveal"?1e3:2e3)+v*17,y=u+v*t.layerPhaseOffset+(Ue(A+9.9)-.5)*t.layerPhaseJitter;if(!t.enableBlur){e.filter!=="none"&&(e.filter="none"),e.globalAlpha=M.alpha*b*.18,je(e,t,g*1.1,T*1.1,y+.33,d,{steps:p,detail:h,seed:A+303}),e.fill(),e.globalAlpha=M.alpha*b*.32,je(e,t,g*1.04,T*1.04,y+.22,d,{steps:p,detail:h,seed:A+101}),e.fill(),e.globalAlpha=M.alpha*b,je(e,t,g,T,y,d,{steps:p,detail:h,seed:A}),e.fill();continue}const C=t.featherBasePx+(n.length-1-v)*t.blurStepPx,I=t.enableBlur?`blur(${C*t.featherMult}px)`:"none";e.filter!==I&&(e.filter=I),e.globalAlpha=M.alpha*b*.55,je(e,t,g*1.03,T*1.03,y+.22,d,{steps:p,detail:h,seed:A+101}),e.fill();const m=Math.max(.4,C*t.coreMult),w=t.enableBlur?`blur(${m}px)`:"none";e.filter!==w&&(e.filter=w),e.globalAlpha=M.alpha*b,je(e,t,g,T,y,d,{steps:p,detail:h,seed:A}),e.fill()}e.filter!=="none"&&(e.filter="none"),e.restore(),e.globalAlpha=1}function Qt(e,t){const n=document.createElement("canvas");return n.width=e,n.height=t,n}function Cs(e){if(e.startsWith("http://")||e.startsWith("https://"))return e;const t=dt();return e.startsWith(t)?`/${vn(e.slice(t.length))}`:e}async function ks(e){const t=Cs(e),n=fe.getImage(t);if(n)return{img:n,fromAssetCache:!0};const r=new Image;return r.decoding="async",r.src=e,r.complete?{img:r,fromAssetCache:!1}:(await new Promise((s,a)=>{r.onload=()=>s(),r.onerror=()=>a(new Error(`Failed to load image: ${e}`))}),{img:r,fromAssetCache:!1})}function Rs(e){if(e instanceof HTMLImageElement){const n=e.naturalWidth||e.width,r=e.naturalHeight||e.height;return!n||!r?null:{w:n,h:r}}if(e instanceof HTMLCanvasElement){const n=e.width,r=e.height;return!n||!r?null:{w:n,h:r}}if(typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=e.width,r=e.height;return!n||!r?null:{w:n,h:r}}const t=e;if(typeof t.width=="number"&&typeof t.height=="number"){const n=t.width,r=t.height;return!n||!r?null:{w:n,h:r}}return null}function Xt(e,t,n,r){const s=Rs(t);if(!s)return;const a=s.w,o=s.h,l=Math.max(n/a,r/o),u=a*l,d=o*l,f=(n-u)/2,h=(r-d)/2;e.drawImage(t,f,h,u,d)}function Ns({canvasRef:e,containerRef:t,cfg:n,openMs:r,closeMs:s,opacity:a,onLayoutSize:o}){const l=i.useMemo(()=>Ss(),[]),u=!l,d=2,f=60,h=32,p=16e5,v=i.useRef(0),M=i.useRef({w:0,h:0,dpr:1}),P=i.useRef({x:.9,y:.85}),b=i.useRef({css:0,px:0}),x=i.useRef(null),S=i.useRef(null),g=i.useRef(he()),T=i.useRef(0),A=i.useRef(0),y=i.useRef(null),C=i.useRef(null),I=i.useRef(null),m=i.useRef({motion:"open",reveal:0,alpha:0,phaseShift:0,currentSrc:"",nextSrc:""}),w=i.useRef(new Map),E=i.useRef(new Map),F=i.useRef(Vt(n)),L=i.useRef(null),j=i.useRef(null),G=i.useCallback(()=>{x.current!==null&&(cancelAnimationFrame(x.current),x.current=null)},[]),te=i.useCallback(()=>{const N=S.current;N&&x.current===null&&(x.current=requestAnimationFrame(N))},[]),X=i.useCallback(N=>{const D=new Set(N.filter(Boolean)),_=w.current;for(const k of Array.from(_.keys()))if(!D.has(k)){const q=_.get(k);_.delete(k),q==null||q.release()}for(;_.size>h;){const k=_.keys().next().value;if(!k)break;if(D.has(k)){const z=_.get(k);z?(_.delete(k),_.set(k,z)):_.delete(k);continue}const q=_.get(k);_.delete(k),q==null||q.release()}},[h]);i.useEffect(()=>{F.current=Vt(n)},[n]),i.useEffect(()=>{const N=t.current;if(!N)return;const D=()=>{const k=Math.max(1,Math.round(N.clientWidth)),q=Math.max(1,Math.round(N.clientHeight)),z=Math.max(1,Math.min(d,window.devicePixelRatio||1));M.current={w:k,h:q,dpr:z},o==null||o({w:k,h:q});const V=e.current;if(!V)return;const U=Math.max(1,Math.floor(k*z)),K=Math.max(1,Math.floor(q*z));V.width!==U&&(V.width=U),V.height!==K&&(V.height=K);const ne=n.enableBlur,se=Math.max(1,Math.round(n.layersCount)),ie=ne?n.featherBasePx+(se-1)*n.blurStepPx:0,B=ne?Math.ceil(ie*n.featherMult+6):0,O=Math.max(0,Math.ceil(B*z));b.current={css:B,px:O};const ee=U+O*2,H=K+O*2;L.current||(L.current=Qt(ee,H)),j.current||(j.current=Qt(ee,H)),L.current.width!==ee&&(L.current.width=ee),L.current.height!==H&&(L.current.height=H),j.current.width!==ee&&(j.current.width=ee),j.current.height!==H&&(j.current.height=H),C.current=L.current.getContext("2d"),I.current=j.current.getContext("2d")};D();const _=new ResizeObserver(D);return _.observe(N),()=>_.disconnect()},[e,t,n.enableBlur,n.blurStepPx,n.featherBasePx,n.featherMult,n.layersCount,d,o]);const Z=i.useCallback(async N=>{const{img:D,fromAssetCache:_}=await ks(N),{w:k,h:q,dpr:z}=M.current,V=Math.max(1,Math.floor(k*z)),U=Math.max(1,Math.floor(q*z)),K=V*U,ne=K>p?Math.sqrt(p/Math.max(1,K)):1,se=Math.max(1,Math.floor(V*ne)),ie=Math.max(1,Math.floor(U*ne)),B=document.createElement("canvas");B.width=se,B.height=ie;const O=B.getContext("2d");if(O&&(O.imageSmoothingEnabled=!0,Xt(O,D,se,ie)),!_)try{D.src=""}catch{}return{source:B,release:()=>{B.width=0,B.height=0}}},[p]),R=i.useCallback(async N=>{if(!N||w.current.has(N))return;const D=E.current.get(N);if(D){await D;return}const _=Z(N).then(k=>{w.current.set(N,k)}).catch(()=>{}).finally(()=>{E.current.delete(N)});E.current.set(N,_),await _},[Z]),$=i.useCallback(N=>{R(N)},[R]);i.useEffect(()=>{const N=e.current;if(!N||(y.current=N.getContext("2d"),!y.current))return;const D=()=>{x.current===null&&S.current&&(x.current=requestAnimationFrame(S.current))},_=()=>{x.current=null;try{if(document.visibilityState==="hidden")return}catch{}const{w:q,h:z,dpr:V}=M.current;if(!q||!z){D();return}const U=m.current,K=U.currentSrc;if(!K)return;const ne=w.current,se=ne.get(K);if(!se){$(K),D();return}ne.delete(K),ne.set(K,se),X([K,U.nextSrc]);const ie=L.current,B=j.current,O=y.current,ee=C.current,H=I.current;if(!ie||!B||!O||!ee||!H){D();return}const ae=se.source,oe=he(),le=1e3/Math.max(1,f);if(oe-T.current<le){D();return}T.current=oe;const xe=n.enableBlur?n:{...n,enableBlur:!1},Be=U.motion==="close"||U.reveal<.999||U.alpha<.999,et=Be||u;let ze=A.current;et&&(ze=(oe-g.current)/1e3+U.phaseShift,A.current=ze);const un=N.width,dn=N.height;O.setTransform(1,0,0,1,0,0),O.clearRect(0,0,un,dn),O.setTransform(V,0,0,V,0,0),O.globalAlpha=U.alpha*a,O.globalCompositeOperation="source-over",O.imageSmoothingEnabled=!0,Xt(O,ae,q,z);const Mt=Ps(xe,q,z),Oe={a:Mt.a*P.current.x,b:Mt.b*P.current.y},At=F.current,ce=b.current.css;ee.setTransform(1,0,0,1,0,0),ee.clearRect(0,0,ie.width,ie.height),ee.setTransform(V,0,0,V,0,0),ee.translate(ce,ce),Ut(ee,xe,At,q*.5,z*.5,Oe.a,Oe.b,1,ze*xe.portalTSpeed,"portal","open"),O.globalCompositeOperation="destination-in",O.drawImage(ie,-ce,-ce,q+ce*2,z+ce*2),H.setTransform(1,0,0,1,0,0),H.clearRect(0,0,B.width,B.height),H.setTransform(V,0,0,V,0,0),H.translate(ce,ce),Ut(H,xe,At,q*.5,z*.5,Oe.a,Oe.b,U.reveal,ze*xe.revealTSpeed,"reveal",U.motion),O.drawImage(B,-ce,-ce,q+ce*2,z+ce*2),O.globalCompositeOperation="source-over",(Be||u)&&D()};S.current=_;const k=()=>{try{if(document.visibilityState==="hidden")G();else if(m.current.currentSrc){const q=m.current,z=A.current;g.current=he()-Math.max(0,z-q.phaseShift)*1e3,te()}}catch{}};return document.addEventListener("visibilitychange",k),window.addEventListener("pagehide",G),window.addEventListener("pageshow",k),m.current.currentSrc&&te(),()=>{document.removeEventListener("visibilitychange",k),window.removeEventListener("pagehide",G),window.removeEventListener("pageshow",k),S.current=null,G()}},[e,n,$,te,u,a,X,G,f]);const W=i.useCallback(N=>{if(!N)return;const D=++v.current,_=()=>{if(v.current!==D)return;const k=m.current,q=!k.currentSrc||k.reveal<=.001||k.alpha<=.001,z=K=>As(K,3),V=K=>Yt(K,3),U=(K,ne,se,ie,B,O)=>{const ee=he(),H=Math.max(1,ie),ae=()=>{if(v.current!==D)return;const oe=pe((he()-ee)/H),le=B(oe);m.current[K]=ne+(se-ne)*le,oe<1?requestAnimationFrame(ae):O==null||O()};requestAnimationFrame(ae)};if(te(),q){k.phaseShift=Math.random()*1e3,g.current=he(),A.current=0,k.currentSrc=N,k.nextSrc="",k.motion="open",k.reveal=0,k.alpha=0,X([k.currentSrc]),U("reveal",0,1,r,z),U("alpha",0,1,Math.round(r*.7),z);return}k.nextSrc=N,X([k.currentSrc,k.nextSrc]),k.motion="close",k.alpha=1,U("reveal",k.reveal,0,s,V,()=>{v.current===D&&(k.nextSrc&&(k.currentSrc=k.nextSrc,k.nextSrc=""),k.phaseShift=Math.random()*1e3,g.current=he(),A.current=0,k.motion="open",U("reveal",0,1,r,z))})};if(!w.current.has(N)){R(N).then(()=>{w.current.has(N)&&_()});return}_()},[s,te,r,R,X]),Q=i.useCallback(async N=>{N&&await R(N)},[R]),J=i.useCallback(()=>{const N=++v.current,D=m.current,_=K=>Yt(K,3),k=D.reveal,q=D.alpha,z=he(),V=Math.max(1,s),U=()=>{if(v.current!==N)return;const K=pe((he()-z)/V),ne=_(K);D.motion="close",D.reveal=k+(0-k)*ne,D.alpha=q+(0-q)*ne,K<1?requestAnimationFrame(U):(D.currentSrc="",D.nextSrc="",X([]))};te(),requestAnimationFrame(U)},[s,te,X]);i.useEffect(()=>{},[e,te,u,d,p,X,l,G,f]);const Y=i.useCallback(()=>{const N=m.current;return!!N.currentSrc&&N.alpha>.01},[]);return i.useMemo(()=>({show:W,hide:J,isShowing:Y,preload:Q}),[J,Y,Q,W])}function Fs({config:e,slideshowScreen:t,campaignId:n,difficulty:r,isMusicPlaying:s,onToggleMusic:a,activated:o,className:l="",onPanelsCeilingChange:u,onPortalHeightChange:d}){var k,q;const f=i.useRef(null),h=i.useRef(null),p=i.useRef(null),v=((k=e.headerSlideshow)==null?void 0:k.enableBlur)??!1,[M,P]=i.useState(0),{enabled:b,isLoading:x,images:S,basePath:g,subfolder:T,displayDuration:A,transitionDuration:y,opacity:C}=ms(e.headerSlideshow,{gameId:e.id,campaignId:n,screen:t,difficulty:r}),I=t==="play"?((q=e.headerSlideshow)==null?void 0:q.campaignImageOrder)??"random":"random",m=i.useMemo(()=>I!=="alphabetical"?S:[...S].sort((z,V)=>z.localeCompare(V,void 0,{numeric:!0,sensitivity:"base"})),[S,I]),w=Math.max(400,Math.round(y*.65)),E=Math.max(250,Math.round(y*.5)),F=i.useMemo(()=>({...Ms,enableBlur:v}),[v]),L=Ns({canvasRef:p,containerRef:h,cfg:F,openMs:w,closeMs:E,opacity:C,onLayoutSize:i.useCallback(({h:z})=>P(z),[])}),{show:j,hide:G}=L,[te,X]=i.useState(0),Z=i.useMemo(()=>{const z=m[te];return z?T?`${g}/${T}/${z}`:`${g}/${z}`:""},[g,te,m,T]);i.useEffect(()=>{!b||x||m.length===0||X(0)},[b,x,I,m]),i.useEffect(()=>{if(!o){G();return}if(!b){G();return}if(x){t==="start"&&!n&&G();return}if(!Z){G();return}j(Z)},[o,n,b,Z,G,x,j,t]),i.useEffect(()=>{if(!o||!b||x||m.length<=1)return;const z=window.setInterval(()=>{X(V=>{if(I==="alphabetical")return(V+1)%m.length;let U=0;do U=Math.floor(Math.random()*m.length);while(U===V&&m.length>1);return U})},A);return()=>window.clearInterval(z)},[o,A,b,x,I,m.length]);const R=hs(),[$,W]=i.useState(de),Q=Math.round($.translateY),J=$.scale,Y=Math.round($.panelsOverlap),N=Math.max(1,Math.round((M||162)*J)),D=vs(f),_=Math.max(Q,-Math.round(D));return i.useEffect(()=>{u==null||u(Y)},[u,Y]),i.useEffect(()=>{d==null||d(N)},[N,d]),c.jsxs(c.Fragment,{children:[c.jsx(bs,{translateY:_,scale:J,active:o,containerRef:h,canvasRef:p}),c.jsx("div",{className:`relative overflow-visible max-w-4xl mx-auto w-full ${l}`,ref:f,style:{minHeight:N,opacity:o?1:0,transition:"opacity 260ms ease",pointerEvents:"none"},children:c.jsxs("div",{className:"fixed top-3 right-3 z-[250] pointer-events-auto flex flex-col items-end gap-2",children:[c.jsx(Ir,{onClick:a,title:s?e.strings.musicOn:e.strings.musicOff,children:s?"ðŸ”Š":"ðŸ”‡"}),R&&c.jsx("div",{className:"mt-3",children:c.jsx(ds,{storageKey:`engine:portal-header-tuner:${e.id}`,disabled:!o,onChange:W})})]})})]})}function js(){var e,t;try{return((t=(e=window.matchMedia)==null?void 0:e.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:t.matches)??!1}catch{return!1}}function $s({config:e,theme:t,phase:n,onEntered:r,onExited:s,className:a=""}){var y;const o=i.useRef(null),l=i.useRef(null),u=i.useRef(null),d=js(),f=((y=e.headerSlideshow)==null?void 0:y.enableBlur)??!1,h=!!t.isLight,p=t.textTitle??t.textPrimary,v=h?`0 2px 10px rgba(15, 23, 42, 0.75), 0 6px 18px rgba(15, 23, 42, 0.45), 0 0 18px ${t.glowColor}99, 0 0 34px ${t.glowColor}66`:`0 2px 12px rgba(0,0,0,0.9), 0 8px 22px rgba(0,0,0,0.6), 0 0 20px ${t.glowColor}b3, 0 0 38px ${t.glowColor}80`,M=t.headerTextShadow??v,P=(C,I)=>{if(!C)return null;if(C.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)){const E=C.length===4?`#${C[1]}${C[1]}${C[2]}${C[2]}${C[3]}${C[3]}`:C,F=Number.parseInt(E.slice(1,3),16),L=Number.parseInt(E.slice(3,5),16),j=Number.parseInt(E.slice(5,7),16);return`rgba(${F}, ${L}, ${j}, ${I})`}const w=C.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);return w?`rgba(${w[1]}, ${w[2]}, ${w[3]}, ${I})`:null},b=t.glowColor??t.glow??"#60a5fa",x=i.useMemo(()=>`radial-gradient(ellipse at center, ${P(b,h?.28:.22)??"rgba(255,255,255,0.2)"} 0%, rgba(0,0,0,0) 72%)`,[b,h]),S=x,g={"--portal-title-highlight":x,"--portal-title-highlight-opacity":h?"0.95":"0.88","--portal-title-highlight-blur":f?"3px":"2px","--portal-title-highlight-width":"120%","--portal-title-highlight-height":"210%"},T={"--portal-title-highlight":S,"--portal-title-highlight-opacity":h?"0.95":"0.88","--portal-title-highlight-blur":f?"3px":"2px","--portal-title-highlight-width":"80%","--portal-title-highlight-height":"210%"};i.useEffect(()=>{d&&(n==="enter"&&(r==null||r()),n==="exit"&&(s==null||s()))},[r,s,n,d]),i.useLayoutEffect(()=>{const C=o.current,I=l.current,m=u.current;if(!C||!I||!m)return;let w=null;const E=()=>{w!=null&&window.cancelAnimationFrame(w),w=window.requestAnimationFrame(()=>{w=null,I.style.fontSize="",m.style.fontSize="";const G=C.clientWidth;if(G<=0)return;const te=Math.max(12,Math.round(G*.07)),X=Math.max(0,G-te*2);if(X<=0)return;const Z=I.scrollWidth,R=m.scrollWidth,$=Math.max(Z,R);if($<=0||$<=X)return;const W=Math.min(1,(X-1)/$);if(W>=1)return;const Q=Number.parseFloat(window.getComputedStyle(I).fontSize),J=Number.parseFloat(window.getComputedStyle(m).fontSize);!Number.isFinite(Q)||!Number.isFinite(J)||(I.style.fontSize=`${Math.max(10,Q*W).toFixed(2)}px`,m.style.fontSize=`${Math.max(9,J*W).toFixed(2)}px`)})};E();const F=new ResizeObserver(()=>E());F.observe(C);let L=!1;const j=document==null?void 0:document.fonts;return j!=null&&j.ready&&j.ready.then(()=>{L||E()}),()=>{L=!0,F.disconnect(),w!=null&&window.cancelAnimationFrame(w)}},[e.subtitle,e.title]);const A=n==="enter"?"portal-title__motion--enter":n==="exit"?"portal-title__motion--exit":"";return c.jsx("div",{className:`portal-title absolute inset-0 z-[80] flex items-center justify-center px-4 overflow-visible ${a}`,children:c.jsx("div",{className:`relative overflow-visible w-[min(1120px,100%)] ${A}`,onAnimationEnd:C=>{d||(n==="enter"&&C.animationName==="portal-title-arrive"&&(r==null||r()),n==="exit"&&C.animationName==="portal-title-evaporate"&&(s==null||s()))},children:c.jsx("div",{className:"relative max-w-5xl mx-auto text-center flex items-center justify-center min-h-[165px] md:min-h-[175px]",children:c.jsxs("div",{ref:o,className:"relative z-10 space-y-1 w-full max-w-[920px] overflow-visible",children:[c.jsx("h1",{ref:l,className:`portal-title__line w-full max-w-full mx-auto text-[clamp(12px,4.8vw,30px)] font-bold tracking-[0.06em] sm:tracking-[0.12em] md:tracking-[0.18em] whitespace-nowrap transition-colors duration-500 ${p}`,style:{...g,textShadow:`${M}, 0 0 16px ${b}99, 0 0 36px ${b}66`},children:c.jsx("span",{className:"portal-title__line-text",children:e.title})}),c.jsx("h2",{ref:u,className:`portal-title__line w-full max-w-full mx-auto text-[clamp(11px,3.6vw,18px)] tracking-wide whitespace-nowrap transition-colors duration-500 ${p}`,style:{...T,lineHeight:"1.5",fontStyle:"italic",textShadow:`${M}, 0 0 16px ${b}99, 0 0 36px ${b}66`},children:c.jsx("span",{className:"portal-title__line-text",children:e.subtitle})})]})})})})}function Ds(){return c.jsx("span",{"aria-hidden":"true",children:"ðŸ”Š"})}function Bs(){return c.jsx("span",{"aria-hidden":"true",children:"ðŸ”‡"})}function zs({config:e,onEnableSound:t,onDisableSound:n,isClosing:r=!1}){var f;const s=Ze(),a=((f=e.icons)==null?void 0:f.headphones)??Lr,o=i.useMemo(()=>{const h={title:"Ð—Ð²ÑƒÐº Ð² Ð¸Ð³Ñ€Ðµ",message:`Ð­Ñ‚Ð° Ð¸Ð³Ñ€Ð° Ð»ÑƒÑ‡ÑˆÐµ Ð²ÑÐµÐ³Ð¾ Ð¾Ñ‰ÑƒÑ‰Ð°ÐµÑ‚ÑÑ Ð² Ð½Ð°ÑƒÑˆÐ½Ð¸ÐºÐ°Ñ….
Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐº?`,withSound:"Ð¡Ð¾ Ð·Ð²ÑƒÐºÐ¾Ð¼",withoutSound:"Ð‘ÐµÐ· Ð·Ð²ÑƒÐºÐ°"},p=e.systemStrings;return{title:(p==null?void 0:p.soundConsentTitle)??h.title,message:(p==null?void 0:p.soundConsentMessage)??h.message,withSound:(p==null?void 0:p.soundConsentEnableLabel)??h.withSound,withoutSound:(p==null?void 0:p.soundConsentDisableLabel)??h.withoutSound}},[e.systemStrings]),l=h=>{h.preventDefault(),t()},u=h=>{h.preventDefault(),n()},d="border-3 h-12 w-full flex items-center justify-center bg-gradient-to-b";return c.jsxs("div",{className:"absolute inset-0 z-[100] flex items-center justify-center",role:"dialog","aria-modal":"true","aria-label":o.title,children:[c.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-[1px]"}),c.jsx("div",{className:"relative w-full max-w-lg px-4",children:c.jsxs(be,{className:`p-1 ${r?"animate-dust-out":"animate-slide-in"}`,children:[c.jsx(Ce,{children:o.title}),c.jsxs("div",{className:"p-5 md:p-6 flex flex-col items-center text-center gap-4",children:[c.jsx(a,{}),c.jsx("div",{className:`leading-relaxed whitespace-pre-line ${s.textSecondary}`,children:o.message}),c.jsxs("div",{className:"w-full grid grid-cols-2 gap-3 pt-1",children:[c.jsx(ge,{icon:c.jsx(Ds,{}),ariaLabel:o.withSound,title:o.withSound,disabled:r,className:`${d} ${s.textLifeline} ${s.borderLifeline} ${s.bgLifeline}`,glow:s.glow,boxShadow:`0 0 15px ${s.glow}`,onClick:l}),c.jsx(ge,{icon:c.jsx(Bs,{}),ariaLabel:o.withoutSound,title:o.withoutSound,disabled:r,className:`${d} ${s.textLifeline} ${s.borderLifeline} ${s.bgLifeline}`,glow:s.glowSecondary??s.glow,boxShadow:`0 0 12px ${s.glowSecondary??s.glow}55`,onClick:u})]})]})]})})]})}const ht=e=>{var t;if(typeof e=="string"){const n=e.trim();return n.length?n:null}if(typeof e=="number")return String(e);if(!e)return null;if(Array.isArray(e)){for(const n of e){const r=ht(n);if(r)return r}return null}return typeof e=="object"&&"props"in e?ht((t=e.props)==null?void 0:t.children):null},gt=e=>{var n,r;if(!i.isValidElement(e))return null;if(typeof e.type=="string"&&e.type==="img"){const s=(n=e.props)==null?void 0:n.src;if(typeof s=="string"&&s.length)return s}const t=(r=e.props)==null?void 0:r.children;if(t==null)return null;if(Array.isArray(t)){for(const s of t){const a=gt(s);if(a)return a}return null}return gt(t)},Os=e=>{var t;if(!e||typeof e!="function"||(t=e.prototype)!=null&&t.isReactComponent)return null;try{return e()}catch{return null}},cn=e=>[...new Set(e)],_s=(e,t)=>{const n=cn(e).filter(Boolean),r=Array.from({length:n.length},()=>null),s=Array.from({length:n.length},()=>!1),a=o=>{if(n.length===0)return null;const l=o%n.length,u=r[l];if(u||typeof Image>"u")return u;const d=new Image;return d.decoding="async",d.src=n[l],d.onload=()=>{s[l]=!0},d.onerror=()=>{s[l]=!1},r[l]=d,d};return(o,l,u)=>{if(n.length===0){t(o,l,u);return}const d=Math.abs(u)%n.length,f=a(d);if(f&&s[d]&&f.naturalWidth>0){const h=l*1.2,p=o.imageSmoothingEnabled;o.imageSmoothingEnabled=!0,o.drawImage(f,-h/2,-h/2,h,h),o.imageSmoothingEnabled=p;return}t(o,l,u)}},Kt=e=>{const t=cn(e).map(n=>n.trim()).filter(Boolean);return(n,r,s)=>{if(t.length===0){vt(n,r,s);return}const a=t[Math.abs(s)%t.length];n.save(),n.textAlign="center",n.textBaseline="middle",n.font=`${Math.max(10,Math.round(r*.95))}px system-ui, Apple Color Emoji, Segoe UI Emoji`,n.fillText(a,0,0),n.restore()}},Ws=e=>{var o;if(e.drawCoinParticle)return e.drawCoinParticle;const t=((o=e.icons)==null?void 0:o.coin)??bt,n=Os(t),r=Kt(["ðŸª™"]),s=gt(n);if(s)return _s([s],r);const a=ht(n);return a?Kt([a]):r},qs="radial-gradient(ellipse at center, #1a0f0a 0%, #0d0604 50%, #000 100%)",Hs=/(#(?:[0-9a-fA-F]{3,8})|rgba?\([^)]*\)|hsla?\([^)]*\)|var\([^)]*\))/g,Gs=e=>{const t=e.match(Hs);return!t||t.length===0?"#000":t[t.length-1]};function Ks({config:e,onLoadingStateChange:t}){var se,ie;const n=i.useMemo(()=>rr(e),[e]),r=cr(n),s=br(n),a=Sr(),o=i.useMemo(()=>Ws(n),[n]),{forceWin:l,prizeLadder:u,wonPrize:d}=r,{playVictory:f}=s,{triggerCoins:h}=a;i.useEffect(()=>{},[l,f,u.values,h,d]);const p=Mr("level1",n.id),[v,M]=i.useState(null),[P,b]=i.useState(0),[x,S]=i.useState(!1),[g,T]=i.useState(!1),[A,y]=i.useState(!1),C=i.useMemo(()=>p.isLoading||!p.isComplete&&!p.error?{isLoading:!0,progress:p.progress}:x?{isLoading:!0,progress:P}:{isLoading:!1,progress:100},[x,p.error,p.isComplete,p.isLoading,p.progress,P]);i.useEffect(()=>{t==null||t(C)},[C,t]);const[I,m]=i.useState(null),[w,E]=i.useState(!1),F=i.useRef(!1);i.useEffect(()=>{var O;const B=(O=r.selectedCampaign)==null?void 0:O.id;!B||v===B||(M(B),b(0),fe.loadLevel("level1_1",n.id,B,{onProgress:(ee,H)=>{const ae=H>0?Math.round(ee/H*100):100;b(ae)}}).catch(ee=>re.millionaireGame.warn("Level 1.1 preload",{error:ee})))},[(se=r.selectedCampaign)==null?void 0:se.id,n.id,v]),i.useEffect(()=>{r.gameState==="play"&&r.selectedCampaign&&fe.preloadInBackground("level2",n.id,r.selectedCampaign.id)},[r.gameState,r.selectedCampaign,n.id]);const L=r.selectedCampaign,j=(L==null?void 0:L.theme)||n.campaigns[0].theme,G=i.useMemo(()=>j.bgGradient||qs,[j.bgGradient]),te=i.useMemo(()=>Gs(G),[G]);i.useEffect(()=>{const B=document.documentElement,O=B.style.getPropertyValue("--ui-tint");return B.style.setProperty("--ui-tint",te),()=>{O?B.style.setProperty("--ui-tint",O):B.style.removeProperty("--ui-tint")}},[te]);const X=i.useCallback(B=>{w||(E(!0),m(O=>O&&O!=="exit"?"exit":O)),B.selectSound?s.playCampaignSelectSound(B.selectSound):s.playSoundEffect("answerButton"),r.selectCampaign(B)},[s,r,w]),Z=i.useCallback(B=>{B&&B.button!==0&&B.pointerType!=="touch"||s.playSoundEffect("actionButton")},[s]),R=i.useCallback(async()=>{if(!r.selectedCampaign)return;s.stopCampaignSelectSound();const B=r.selectedCampaign.id;if(!fe.isLevelLoaded("level1_1",n.id,B)){S(!0);try{await fe.loadLevel("level1_1",n.id,B,{onProgress:(O,ee)=>{const H=ee>0?Math.round(O/ee*100):100;b(H)}})}catch(O){re.millionaireGame.warn("Level 1.1 load error",{error:O})}S(!1)}s.playCampaignMusic(r.selectedCampaign),r.startGame()},[s,r,n.id]),$=i.useCallback(()=>{s.playMainMenu(),F.current=!1,E(!1),m(null),r.newGame()},[s,r]),W=i.useCallback(()=>{T(!0)},[]),Q=i.useCallback(()=>{s.isMusicPlaying||s.toggleMusic(),s.playSoundEffect("answerButton"),s.playMainMenu(),y(!0),window.setTimeout(()=>{W(),y(!1)},220)},[s,W]),J=i.useCallback(()=>{s.disableAllSounds(),y(!0),window.setTimeout(()=>{W(),y(!1)},220)},[s,W]),Y=!p.isLoading&&!x,N=Y&&r.gameState==="start"&&(!g||A),D=Y&&!N,[_,k]=i.useState(()=>Math.round(de.panelsOverlap)),[q,z]=i.useState(0),V=i.useMemo(()=>{if(!Y)return 0;const B=.45,O=210,ee=q?Math.max(0,Math.round(q*B)):220,H=q?Math.max(0,q-O):220,ae=Math.min(120,ee,H);return Math.max(_,-ae)},[_,q,Y]);i.useEffect(()=>{F.current||w||D&&r.gameState==="start"&&(r.selectedCampaign||(F.current=!0,m("enter")))},[r.gameState,r.selectedCampaign,D,w]);const U=i.useMemo(()=>r.gameState,[r.gameState]),K=i.useMemo(()=>{if(r.gameState!=="play")return;const B=r.totalQuestions||0;if(B<=0)return;const O=r.currentQuestion/B;return O<1/3?"easy":O<2/3?"medium":"hard"},[r.currentQuestion,r.gameState,r.totalQuestions]),ne=r.gameState==="victory"?"screen-victory":r.gameState==="defeat"?"screen-defeat":r.gameState==="retreat"?"screen-transition-dramatic":"screen-transition";return c.jsx(ar,{theme:j,children:c.jsxs("div",{className:"engine min-h-screen transition-all duration-500 relative overflow-hidden flex flex-col",style:{background:G,fontFamily:n.fontFamily||Mn},children:[c.jsx(es,{effect:a.effectState.effect,origin:a.effectState.origin,primaryColor:a.effectState.primaryColor,secondaryColor:a.effectState.secondaryColor,intensity:a.effectState.intensity,drawCoin:o,lostSparkColors:n.lostSparkColors}),N&&c.jsx(zs,{config:n,onEnableSound:Q,onDisableSound:J,isClosing:A}),c.jsx("audio",{id:"bg-music",loop:!0,preload:"none"}),c.jsxs("div",{className:"w-full flex-1 flex flex-col",children:[Y&&c.jsxs("div",{className:"relative overflow-visible z-0",children:[I&&c.jsx($s,{config:n,theme:j,phase:I,onEntered:()=>m(B=>B==="enter"?"shown":B),onExited:()=>m(null)}),c.jsx(Fs,{config:n,slideshowScreen:U,campaignId:(ie=r.selectedCampaign)==null?void 0:ie.id,difficulty:K,isMusicPlaying:s.isMusicPlaying,onToggleMusic:s.toggleMusic,activated:D,onPanelsCeilingChange:k,onPortalHeightChange:z})]}),c.jsxs("div",{className:"relative z-10 max-w-4xl mx-auto w-full flex-1 flex flex-col",children:[c.jsxs("div",{className:ne,style:{marginTop:V},children:[r.gameState==="start"&&!p.isLoading&&!x&&c.jsx(us,{config:n,selectedCampaign:r.selectedCampaign,onSelectCampaign:X,onStartGame:R,onActionButtonPress:Z,theme:j}),r.gameState==="play"&&r.questions.length>0&&c.jsx(Gr,{config:n,gameState:r,audio:s,theme:j,effects:a,onNewGame:$}),(r.gameState==="victory"||r.gameState==="defeat"||r.gameState==="retreat")&&c.jsx(Fr,{config:n,gameState:r,onNewGame:$,onActionButtonPress:Z,theme:j,effects:a})]},r.gameState),c.jsx("div",{className:"text-center mt-4 text-xs tracking-wide italic text-amber-400/70",children:n.strings.footer})]})]})]})})}export{Ks as MillionaireGame,Ks as default};
