@keyframes glare-sweep {
  0% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-start, -150%));
  }
  100% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-end, 150%));
  }
}

/* Identical keyframes under a different name so we can force-restart the animation. */
@keyframes glare-sweep-alt {
  0% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-start, -150%));
  }
  100% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-end, 150%));
  }
}
 

@keyframes glare-sweep-reverse {
  0% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-end, 150%));
  }
  100% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-start, -150%));
  }
}

/* Identical keyframes under a different name so we can force-restart the animation. */
@keyframes glare-sweep-reverse-alt {
  0% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-end, 150%));
  }
  100% {
    transform: skewX(var(--glare-skew, -25deg))
      translateX(var(--glare-start, -150%));
  }
}

.engine .glare {
  position: relative;
  overflow: hidden;
  --glare-width: 60%;
  --glare-duration: 0.8s;
  --glare-press-duration: 0.2s;
  --glare-blur: 5px;
  --glare-skew: -25deg;
  --glare-rest: -150%;
  --glare-start: -150%;
  --glare-end: 150%;
  --glare-opacity: 1;
}

.engine .glare::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    115deg,
    transparent 0%,
    transparent calc(var(--glare-width, 60%) * 0.25),
    rgba(255, 255, 255, 0.1) calc(var(--glare-width, 60%) * 0.45),
    rgba(255, 255, 255, 0.28) calc(var(--glare-width, 60%) * 0.55),
    rgba(255, 255, 255, 0.1) calc(var(--glare-width, 60%) * 0.7),
    transparent calc(var(--glare-width, 60%) * 0.85),
    transparent var(--glare-width, 60%)
  );
  transform: skewX(var(--glare-skew, -25deg))
    translateX(var(--glare-rest, var(--glare-start, -150%)));
  filter: blur(var(--glare-blur, 3px));
  opacity: var(--glare-opacity, 1);
  pointer-events: none;
  will-change: transform;
  z-index: 10;
}

/* Desktop / real hover: drive glare from :hover/:active, and force-restart by toggling data-glare-phase. */
@media (hover: hover) and (pointer: fine) {
  .engine .glare:not(:disabled):hover[data-glare-phase='a']::before {
    animation: glare-sweep var(--glare-duration, 0.5s) ease-out forwards;
  }
  .engine .glare:not(:disabled):hover[data-glare-phase='b']::before {
    animation: glare-sweep-alt var(--glare-duration, 0.5s) ease-out forwards;
  }
}

/* Active/press glare should work everywhere (including touch), even if hover media queries don't match. */
.engine .glare:not(:disabled):active[data-glare-phase='a']::before {
  animation: glare-sweep-reverse var(--glare-press-duration, 0.2s) ease-out
    forwards;
}
.engine .glare:not(:disabled):active[data-glare-phase='b']::before {
  animation: glare-sweep-reverse-alt var(--glare-press-duration, 0.2s) ease-out
    forwards;
}

/* Touch / no hover: use our Button FSM states for reliable "press" and "release" glare. */
@media (hover: none) {
  /* On touch, avoid starting the reverse sweep via :active before the FSM press state is applied. */
  .engine .glare:not(:disabled):active[data-glare-phase='a']::before {
    animation: none;
  }
  .engine .glare:not(:disabled):active[data-glare-phase='b']::before {
    animation: none;
  }

  .engine .glare[data-btn-state='Activate'][data-glare-phase='a']:not(:disabled)::before {
    animation: glare-sweep var(--glare-duration, 0.5s) ease-out forwards;
  }
  .engine .glare[data-btn-state='Activate'][data-glare-phase='b']:not(:disabled)::before {
    animation: glare-sweep-alt var(--glare-duration, 0.5s) ease-out forwards;
  }

  .engine .glare[data-btn-state='Press'][data-glare-phase='a']:not(:disabled)::before {
    animation: glare-sweep-reverse var(--glare-press-duration, 0.2s) ease-out
      forwards;
  }
  .engine .glare[data-btn-state='Press'][data-glare-phase='b']:not(:disabled)::before {
    animation: glare-sweep-reverse-alt var(--glare-press-duration, 0.2s) ease-out
      forwards;
  }
}
