<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Millionaire Sounds Sandbox</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
      color: #e0e0e0;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      color: #888;
      margin-bottom: 30px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      max-width: 900px;
      margin: 0 auto 30px;
    }
    .sound-btn {
      padding: 15px 25px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 140px;
    }
    .sound-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    .sound-btn:active {
      transform: scale(0.98);
    }
    .btn-click { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .btn-intro { background: linear-gradient(135deg, #f093fb, #f5576c); color: white; }
    .btn-thinking { background: linear-gradient(135deg, #4facfe, #00f2fe); color: #1a1a2e; }
    .btn-final { background: linear-gradient(135deg, #fa709a, #fee140); color: #1a1a2e; }
    .btn-correct { background: linear-gradient(135deg, #11998e, #38ef7d); color: #1a1a2e; }
    .btn-wrong { background: linear-gradient(135deg, #eb3349, #f45c43); color: white; }
    .btn-timeout { background: linear-gradient(135deg, #c31432, #240b36); color: white; }
    .btn-money { background: linear-gradient(135deg, #f7971e, #ffd200); color: #1a1a2e; }

    .params {
      max-width: 600px;
      margin: 0 auto 30px;
      background: rgba(255,255,255,0.05);
      padding: 20px;
      border-radius: 12px;
    }
    .params h3 {
      margin-top: 0;
      color: #ffd700;
    }
    .param-row {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 12px;
    }
    .param-row label {
      min-width: 120px;
    }
    .param-row input[type="range"] {
      flex: 1;
    }
    .param-row span {
      min-width: 50px;
      text-align: right;
      font-family: monospace;
    }

    .info {
      max-width: 800px;
      margin: 30px auto;
      background: rgba(255,255,255,0.03);
      padding: 20px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.6;
    }
    .info h3 { color: #ffd700; margin-top: 0; }
    code {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
    }
  </style>
</head>
<body>
  <h1>üéµ Millionaire Sounds Sandbox</h1>
  <p class="subtitle">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ü–∏–ª–ª—è—Ç–æ—Ä–Ω—ã—Ö –∑–≤—É–∫–æ–≤ –¥–ª—è "–ö—Ç–æ —Ö–æ—á–µ—Ç —Å—Ç–∞—Ç—å –º–∏–ª–ª–∏–æ–Ω–µ—Ä–æ–º"</p>

  <div class="params">
    <h3>‚öôÔ∏è –ü–∞—Ä–∞–º–µ—Ç—Ä—ã</h3>
    <div class="param-row">
      <label>–ì—Ä–æ–º–∫–æ—Å—Ç—å:</label>
      <input type="range" id="masterVolume" min="0" max="100" value="40">
      <span id="volumeVal">40%</span>
    </div>
    <div class="param-row">
      <label>–ù–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞:</label>
      <input type="range" id="questionIndex" min="1" max="15" value="1">
      <span id="questionVal">1</span>
    </div>
    <div class="param-row">
      <label>–¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü–∏—è:</label>
      <span id="transposeVal" style="flex:1; text-align:left;">+0 –ø–æ–ª—É—Ç–æ–Ω–æ–≤</span>
    </div>
  </div>

  <div class="controls">
    <button class="sound-btn btn-click" onclick="playClick()">üñ±Ô∏è Click</button>
    <button class="sound-btn btn-intro" onclick="playIntro()">üé¨ Intro</button>
    <button class="sound-btn btn-thinking" onclick="playThinking()">ü§î Thinking</button>
    <button class="sound-btn btn-final" onclick="playFinalAnswer()">üîí Final Answer</button>
    <button class="sound-btn btn-correct" onclick="playCorrect()">‚úÖ Correct</button>
    <button class="sound-btn btn-wrong" onclick="playWrong()">‚ùå Wrong</button>
    <button class="sound-btn btn-timeout" onclick="playTimeout()">‚è∞ Timeout</button>
    <button class="sound-btn btn-money" onclick="playMoney()">üí∞ Money</button>
  </div>

  <div class="info">
    <h3>üìã –û–ø–∏—Å–∞–Ω–∏–µ –∑–≤—É–∫–æ–≤</h3>
    <ul>
      <li><strong>Click</strong> ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π –∫–ª–∏–∫ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ—Ç–≤–µ—Ç–∞</li>
      <li><strong>Intro</strong> ‚Äî —Å—Ç–∏–Ω–≥ –Ω–∞—á–∞–ª–∞ –≤–æ–ø—Ä–æ—Å–∞ (–∞–∫–∫–æ—Ä–¥ + —Ö–æ–¥ –≤–≤–µ—Ä—Ö)</li>
      <li><strong>Thinking</strong> ‚Äî —Ñ–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞ –Ω–∞ —Ä–∞–∑–¥—É–º—å—è (2-—Ç–∞–∫—Ç–æ–≤—ã–π –ª—É–ø, –∏–≥—Ä–∞–µ—Ç 4 —Ä–∞–∑–∞)</li>
      <li><strong>Final Answer</strong> ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ (–Ω–∏—Å—Ö–æ–¥—è—â–∞—è —Ñ—Ä–∞–∑–∞)</li>
      <li><strong>Correct</strong> ‚Äî –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–≤–æ—Å—Ö–æ–¥—è—â–µ–µ –∞—Ä–ø–µ–¥–∂–∏–æ)</li>
      <li><strong>Wrong</strong> ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (–º—Ä–∞—á–Ω–∞—è —Ñ—Ä–∞–∑–∞ D#‚ÜíG#‚ÜíD‚ÜíC#)</li>
      <li><strong>Timeout</strong> ‚Äî –≤—Ä–µ–º—è –≤—ã—à–ª–æ (–∑–ª–æ–≤–µ—â–∏–π –∞–∫–∫–æ—Ä–¥)</li>
      <li><strong>Money</strong> ‚Äî –∑–∞–±—Ä–∞—Ç—å –¥–µ–Ω—å–≥–∏ (–ø–æ–±–µ–¥–Ω—ã–µ –º–æ–Ω–µ—Ç–∫–∏)</li>
    </ul>
    <p>–¢—Ä–∞–Ω—Å–ø–æ–∑–∏—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: <code>+1 –ø–æ–ª—É—Ç–æ–Ω –∫–∞–∂–¥—ã–µ 2 –≤–æ–ø—Ä–æ—Å–∞</code></p>
  </div>

<script>
// ============================================
// Audio Context
// ============================================
let audioCtx = null;

function getAudioContext() {
  if (!audioCtx) {
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  }
  if (audioCtx.state === 'suspended') {
    audioCtx.resume();
  }
  return audioCtx;
}

// ============================================
// Note utilities
// ============================================
const NOTE_SEMITONES = {
  'C': 0, 'C#': 1, 'Db': 1,
  'D': 2, 'D#': 3, 'Eb': 3,
  'E': 4,
  'F': 5, 'F#': 6, 'Gb': 6,
  'G': 7, 'G#': 8, 'Ab': 8,
  'A': 9, 'A#': 10, 'Bb': 10,
  'B': 11,
};

function noteToMidi(note) {
  if (note === 'REST') return null;
  const match = note.match(/^([A-G]#?)(\d)$/);
  if (!match) return null;
  const [, name, octStr] = match;
  const semitone = NOTE_SEMITONES[name];
  const octave = parseInt(octStr);
  return 12 * (octave + 1) + semitone;
}

function midiToFreq(midi) {
  return 440 * Math.pow(2, (midi - 69) / 12);
}

function noteToFreq(note, semitoneOffset = 0) {
  const midi = noteToMidi(note);
  if (midi === null) return null;
  return midiToFreq(midi + semitoneOffset);
}

// ============================================
// Parameters
// ============================================
function getMasterVolume() {
  return parseInt(document.getElementById('masterVolume').value) / 100;
}

function getQuestionIndex() {
  return parseInt(document.getElementById('questionIndex').value);
}

function getSemitoneOffset() {
  const q = getQuestionIndex();
  return Math.floor((q - 1) / 2);
}

// Update displays
document.getElementById('masterVolume').addEventListener('input', (e) => {
  document.getElementById('volumeVal').textContent = e.target.value + '%';
});

document.getElementById('questionIndex').addEventListener('input', (e) => {
  document.getElementById('questionVal').textContent = e.target.value;
  const offset = Math.floor((parseInt(e.target.value) - 1) / 2);
  document.getElementById('transposeVal').textContent = `+${offset} –ø–æ–ª—É—Ç–æ–Ω–æ–≤`;
});

// ============================================
// Pattern Player
// ============================================
function playPattern(pattern, options = {}) {
  const ctx = getAudioContext();
  const {
    semitoneOffset = 0,
    bpm = 120,
    type = 'sawtooth',
    masterGain = 0.3,
    attack = 0.01,
    decay = 0.1,
    filterFreq = null,
  } = options;

  const secPerBeat = 60 / bpm;
  let t = ctx.currentTime;
  const volume = masterGain * getMasterVolume();

  // Master gain node
  const master = ctx.createGain();
  master.gain.value = volume;

  // Optional filter
  let output = master;
  if (filterFreq) {
    const filter = ctx.createBiquadFilter();
    filter.type = 'lowpass';
    filter.frequency.value = filterFreq;
    filter.Q.value = 1;
    master.connect(filter);
    filter.connect(ctx.destination);
  } else {
    master.connect(ctx.destination);
  }

  for (const step of pattern) {
    const durSec = step.dur * secPerBeat;

    if (step.note === 'REST') {
      t += durSec;
      continue;
    }

    const freq = noteToFreq(step.note, semitoneOffset);
    if (!freq) {
      t += durSec;
      continue;
    }

    const osc = ctx.createOscillator();
    const gain = ctx.createGain();

    osc.type = step.type || type;
    osc.frequency.setValueAtTime(freq, t);

    // Add slight detune for richness
    if (step.detune) {
      osc.detune.setValueAtTime(step.detune, t);
    }

    const g = (step.gain ?? 1.0);
    const actualAttack = step.attack ?? attack;
    const actualDecay = step.decay ?? decay;

    // Envelope
    gain.gain.setValueAtTime(0.0, t);
    gain.gain.linearRampToValueAtTime(g, t + actualAttack);
    gain.gain.setValueAtTime(g, t + durSec * 0.7);
    gain.gain.linearRampToValueAtTime(0.0, t + durSec + actualDecay);

    osc.connect(gain);
    gain.connect(master);

    osc.start(t);
    osc.stop(t + durSec + actualDecay + 0.05);

    t += durSec;
  }

  return t - ctx.currentTime; // Return duration
}

// Play with second detuned layer for richness
function playPatternLayered(pattern, options = {}) {
  const { detuneAmount = 8 } = options;

  // Main layer
  playPattern(pattern, options);

  // Detuned layer (quieter)
  const detunedPattern = pattern.map(step => ({
    ...step,
    detune: detuneAmount,
    gain: (step.gain ?? 1.0) * 0.5,
  }));
  playPattern(detunedPattern, { ...options, masterGain: options.masterGain * 0.4 });
}

// ============================================
// Sound Patterns
// ============================================

// Click - short blip
const clickPattern = [
  { note: 'G5', dur: 0.08, gain: 0.8 },
];

// Intro sting - dark chord + upward motion
const introPattern = [
  { note: 'C3',  dur: 0.2, gain: 1.0 },
  { note: 'G3',  dur: 0.2, gain: 0.85 },
  { note: 'C4',  dur: 0.2, gain: 0.75 },
  { note: 'D#4', dur: 0.25, gain: 0.85 },
  { note: 'F4',  dur: 0.5, gain: 0.9 },
];

// Thinking music - 2-bar loop in C minor
const thinkingPattern = [
  { note: 'C3',  dur: 0.5 },
  { note: 'D#3', dur: 0.5 },
  { note: 'F3',  dur: 1.0 },
  { note: 'REST', dur: 1.0 },
  { note: 'C3',  dur: 0.5 },
  { note: 'D#3', dur: 0.5 },
  { note: 'F#3', dur: 1.0 },
  { note: 'REST', dur: 1.0 },
];

// Final answer - descending "freeze" phrase
const finalAnswerPattern = [
  { note: 'G4',  dur: 0.35 },
  { note: 'G#4', dur: 0.35 },
  { note: 'G4',  dur: 0.35 },
  { note: 'F4',  dur: 0.35 },
  { note: 'C3',  dur: 1.2, gain: 1.2 },
];

// Correct - ascending victory arpeggio
const correctPattern = [
  { note: 'C4',  dur: 0.12, gain: 0.9 },
  { note: 'G4',  dur: 0.12, gain: 0.9 },
  { note: 'C5',  dur: 0.12, gain: 0.95 },
  { note: 'D#5', dur: 0.4, gain: 1.0 },
  { note: 'G5',  dur: 0.8, gain: 0.9, decay: 0.4 },
];

// Wrong - dark descending phrase (D#‚ÜíG#‚ÜíD‚ÜíC#)
const wrongPattern = [
  { note: 'D#4', dur: 0.3, gain: 1.0 },
  { note: 'G#4', dur: 0.3, gain: 0.95 },
  { note: 'D4',  dur: 0.25, gain: 0.9 },
  { note: 'C#4', dur: 0.8, gain: 1.0, decay: 0.3 },
];

// Timeout - ominous sustained chord
const timeoutPattern = [
  { note: 'D#3', dur: 0.6 },
  { note: 'G#3', dur: 0.6 },
  { note: 'D4',  dur: 0.6 },
  { note: 'C#4', dur: 1.2, decay: 0.5 },
];

// Money - coin sounds (ascending happy tones)
const moneyPattern = [
  { note: 'E5',  dur: 0.12, gain: 0.8 },
  { note: 'G5',  dur: 0.12, gain: 0.85 },
  { note: 'B5',  dur: 0.12, gain: 0.9 },
  { note: 'E6',  dur: 0.15, gain: 0.95 },
  { note: 'REST', dur: 0.1 },
  { note: 'G5',  dur: 0.1, gain: 0.7 },
  { note: 'B5',  dur: 0.1, gain: 0.75 },
  { note: 'E6',  dur: 0.4, gain: 0.9, decay: 0.3 },
];

// ============================================
// Sound Functions
// ============================================

function playClick() {
  playPattern(clickPattern, {
    bpm: 120,
    type: 'sine',
    masterGain: 0.25,
    attack: 0.002,
    decay: 0.05,
  });
}

function playIntro() {
  const offset = getSemitoneOffset();
  playPatternLayered(introPattern, {
    semitoneOffset: offset,
    bpm: 115,
    type: 'sawtooth',
    masterGain: 0.35,
    attack: 0.008,
    decay: 0.12,
    filterFreq: 2000,
  });
}

function playThinking() {
  const offset = getSemitoneOffset();
  // Play 4 repetitions
  const ctx = getAudioContext();
  const secPerBeat = 60 / 108;
  const loopDuration = thinkingPattern.reduce((acc, s) => acc + s.dur, 0) * secPerBeat;

  for (let i = 0; i < 4; i++) {
    setTimeout(() => {
      playPattern(thinkingPattern, {
        semitoneOffset: offset,
        bpm: 108,
        type: 'sawtooth',
        masterGain: 0.22,
        attack: 0.015,
        decay: 0.15,
        filterFreq: 1000,
      });
    }, i * loopDuration * 1000);
  }
}

function playFinalAnswer() {
  const offset = getSemitoneOffset();
  playPatternLayered(finalAnswerPattern, {
    semitoneOffset: offset,
    bpm: 92,
    type: 'triangle',
    masterGain: 0.38,
    attack: 0.012,
    decay: 0.2,
  });
}

function playCorrect() {
  const offset = getSemitoneOffset();
  playPatternLayered(correctPattern, {
    semitoneOffset: offset,
    bpm: 140,
    type: 'triangle',
    masterGain: 0.4,
    attack: 0.005,
    decay: 0.15,
    detuneAmount: 10,
  });
}

function playWrong() {
  playPatternLayered(wrongPattern, {
    semitoneOffset: 0, // No transpose for wrong - always dramatic
    bpm: 76,
    type: 'sawtooth',
    masterGain: 0.45,
    attack: 0.005,
    decay: 0.25,
    filterFreq: 1500,
  });
}

function playTimeout() {
  playPattern(timeoutPattern, {
    semitoneOffset: 0,
    bpm: 68,
    type: 'sawtooth',
    masterGain: 0.4,
    attack: 0.025,
    decay: 0.5,
    filterFreq: 800,
  });
}

function playMoney() {
  const offset = getSemitoneOffset();
  playPattern(moneyPattern, {
    semitoneOffset: offset,
    bpm: 160,
    type: 'triangle',
    masterGain: 0.35,
    attack: 0.003,
    decay: 0.1,
  });
}

// ============================================
// Keyboard shortcuts
// ============================================
document.addEventListener('keydown', (e) => {
  switch(e.key.toLowerCase()) {
    case '1': playClick(); break;
    case '2': playIntro(); break;
    case '3': playThinking(); break;
    case '4': playFinalAnswer(); break;
    case '5': playCorrect(); break;
    case '6': playWrong(); break;
    case '7': playTimeout(); break;
    case '8': playMoney(); break;
  }
});

console.log('üéµ Millionaire Sounds Sandbox loaded!');
console.log('Keyboard shortcuts: 1-8 for sounds');
</script>
</body>
</html>
